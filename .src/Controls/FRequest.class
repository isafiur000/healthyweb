' Gambas class file

Private $rData As Result
Private $aMyFields As String[]
Private $strType As String
Private $strTitle As String

Public Sub _new(res As Result, strTitle As String, strType As String, AllowExport As Boolean)

  $rData = res
  $strTitle = strTitle
  $strType = strType

  WebLabel1.Text = $strTitle
  If $strType = "PatientEncounters" Or If $strType = "PatientRemoteEncounters" Then
    mnuhide.Visible = True
  Else
    mnuhide.Visible = False
  Endif
  mnutransfer.Visible = AllowExport
  SetMenuListGrid()

End

Public Sub SetMenuListGrid()

  If $strType = "PatientEncounters" Then
    mnuimages.Visible = True
    mnubill.Visible = True
    Select MMain.$SISHAppMode
      Case "REP", "HMIS"
        mnumovement.Visible = True
      Case Else
        mnumovement.Visible = False
    End Select
  Else If $strType = "PatientRemoteEncounters" Then
    mnuimages.Visible = True
    mnubill.Visible = True
    mnumovement.Visible = True
  Else If $strType = "ArchivedReports" Then
    mnudoreport.Visible = True
  Else If $strType = "ArchivedRepoReports" Then
    mnudoreport.Visible = True
  Endif
  ShowGridView()

End

Public Sub btnclose_Click()

  Me.Close()

End

Private Sub ShowGridView()

  $aMyFields = New String[]
  modGridView.ReadSmallData(GridView1, $rData, $aMyFields)
  ResizeGridView()

End

Public Sub GridView1_Data(Row As Integer, Column As Integer, Data As WebTableData)

  $rData.MoveTo(Row)
  modGridView.GridViewDecoration(Data, Row)

  If $strType = "YearReport" Then
    If Column = 4 Then
      Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.MediumDate)
    Else If Column = 13 Then
      Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.MediumTime)
    Else
      Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "TransactionActivity" Then
    If Column = 0 Then
      Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else
      Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "StockDB" Then
    If Column = 3 Then
      If $rData[$aMyFields[Column]] <= Now() Then
        Data.Foreground = modBasic.$HighLightColor
      Endif
      Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.MediumDate)
    Else If Column = 4 Then
      Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], -2)
    Else If Column = 5 Then
      Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], gb.Currency)
    Else
      Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "MedList" Then
    If Column = 1 Then
      Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else If Column = 3 Then
      Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], -2)
    Else If Column = 4 Then
      Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], -2)
    Else
      Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "PatientSearch" Then
    If Column = 2 Then
      Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else If Column = 4 Then
      Data.Text = modGeneral.GetUserFullName($rData[$aMyFields[Column]])
    Else
      Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "Billing:SelectedInvoice" Then
    If Column = 2 Then
      Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], gb.Currency)
    Else If Column = 3 Then
      Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], -2)
    Else If Column = 4 Then
      Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], -2)
    Else If Column = 5 Then
      Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], -2)
    Else If Column = 6 Then
      Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], gb.Currency)
    Else If Column = 7 Then
      Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else
      Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "PatientEncounters" Then
    If Column = 1 Then
      Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else If Column = 4 Then
      Data.Text = modGeneral.GetUserFullName($rData[$aMyFields[Column]])
    Else
      Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "PatientRemoteEncounters" Then
    If Column = 1 Then
      Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else If Column = 4 Then
      Data.Text = modGeneral.GetUserFullName($rData[$aMyFields[Column]])
    Else
      Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "AccGroup:Duplicates" Then
    If Column = 2 Then
      Data.Text = modNonMedical.GetReportGroupName($rData[$aMyFields[Column]])
    Else
      Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "Transaction:Purchase" Then
    If Column = 3 Then
      Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], gb.Currency)
    Else If Column = 4 Then
      Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], gb.Currency)
    Else If Column = 5 Then
      Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], -2)
    Else If Column = 6 Then
      Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], gb.Currency)
    Else If Column = 7 Then
      Try Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else If Column = 12 Then
      Data.Text = modDataRepo.GetHospitalTextLabel($rData[$aMyFields[Column]])
    Else
      Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "Transaction:Consume" Then
    If Column = 3 Then
      Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], gb.Currency)
    Else If Column = 4 Then
      Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], -2)
    Else If Column = 5 Then
      Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], gb.Currency)
    Else If Column = 6 Then
      Try Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else If Column = 10 Then
      Data.Text = modDataRepo.GetHospitalTextLabel($rData[$aMyFields[Column]])
    Else
      Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "Transaction:Dispensed" Then
    If Column = 1 Then
      Data.Text = modPatient.GetPatientNameByEnc($rData[$aMyFields[Column]], modDatabase.$syConn)
    Else If Column = 3 Then
      Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], gb.Currency)
    Else If Column = 4 Then
      Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], -2)
    Else If Column = 5 Then
      Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], -2)
    Else If Column = 6 Then
      Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], -2)
    Else If Column = 7 Then
      Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], gb.Currency)
    Else If Column = 8 Then
      Try Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else If Column = 10 Then
      Data.Text = modStock.GetStockNameFromStockno($rData[$aMyFields[Column]])
    Else If Column = 14 Then
      Data.Text = modDataRepo.GetHospitalTextLabel($rData[$aMyFields[Column]])
    Else
      Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "Invoice/Receipt"
    If Column = 0 Then
      Try Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else
      Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "ArchivedReports" Then
    If Column = 1 Then
      Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else
      Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "ArchivedRepoReports" Then
    If Column = 1 Then
      Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else If Column = 9 Then
      Data.Control = btnattach
    Else
      Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "Pharmacy:Cancelled" Then
    If Column = 1 Then
      Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else If Column = 12 Then
      Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else
      Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "PurchaseReference" Then
    If Column = 0 Then
      Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.MediumDate)
    Else If Column = 3 Then
      Data.Text = modStock.GetBatchFromStockNo($rData[$aMyFields[Column]])
    Else If Column = 4 Then
      Data.Text = modReportVar.GetDateTimeReport(modStock.GetExpiryFromStockNo($rData[$aMyFields[Column]]), gb.MediumDate)
    Else
      Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "Telemedicine" Then
    If Column = 2 Then
      Data.Text = modPatient.GetPatientNameByEnc($rData[$aMyFields[Column]])
    Else If Column = 3 Then
      Data.Text = modPatient.GetPatientAgeString($rData[$aMyFields[Column]], Now()) & "/" & modPatient.GetPatientSex($rData[$aMyFields[Column]])
    Else If Column = 7 Then
      Data.Html = $rData[$aMyFields[Column]]
    Else If Column = 12 Then
      Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else
      Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else
    Data.Text = $rData[$aMyFields[Column]]
  Endif

End

Private Sub ResizeGridView()

  With GridView1

    If $strType = "YearReport" Then
      .Columns[0].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
      .Columns[1].Width = CStr(120 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"
      .Columns[3].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[4].Width = CStr(120 * modBasic.$AppWidthRatio) & "px"
      .Columns[5].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[6].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[7].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[8].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[9].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[10].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
      .Columns[11].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
      .Columns[12].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
      .Columns[13].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[14].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[15].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[16].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"

      .Columns[0].Text = "Year"
      .Columns[1].Text = "Invoice"
      .Columns[2].Text = "Name"
      .Columns[3].Text = "PAN"
      .Columns[4].Text = "Date"
      .Columns[5].Text = "ItemAMT"
      .Columns[6].Text = "DiscAMT"
      .Columns[7].Text = "TaxableAMT"
      .Columns[8].Text = "TaxAMT"
      .Columns[9].Text = "TotalAMT"
      .Columns[10].Text = "Synced"
      .Columns[11].Text = "IsPrinted"
      .Columns[12].Text = "IsActive"
      .Columns[13].Text = "Time"
      .Columns[14].Text = "PunchedBy"
      .Columns[15].Text = "PrintedBy"
      .Columns[16].Text = "RealTime"

    Else If $strType = "TransactionActivity" Then
      .Columns[0].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"
      .Columns[1].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[3].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"
      .Columns[4].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"
      .Columns[5].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"

      .Columns[0].Text = "DateTime"
      .Columns[1].Text = "Category"
      .Columns[2].Text = "FormName"
      .Columns[3].Text = "Activity"
      .Columns[4].Text = "Comment"
      .Columns[5].Text = "User"

    Else If $strType = "StockDB" Then
      .Columns[0].Width = CStr(50 * modBasic.$AppWidthRatio) & "px"
      .Columns[1].Width = CStr(275 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[3].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[4].Width = CStr(50 * modBasic.$AppWidthRatio) & "px"
      .Columns[5].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
      .Columns[6].Width = CStr(50 * modBasic.$AppWidthRatio) & "px"
      .Columns[7].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"

      .Columns[0].Text = "No"
      .Columns[1].Text = "Particular"
      .Columns[2].Text = "Batch"
      .Columns[3].Text = "Expiry"
      .Columns[4].Text = "QTY"
      .Columns[5].Text = "SellP"
      .Columns[6].Text = "Order"
      .Columns[7].Text = "Comp"

    Else If $strType = "MedList" Then
      .Columns[0].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
      .Columns[1].Width = CStr(180 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(420 * modBasic.$AppWidthRatio) & "px"
      .Columns[3].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[4].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"

      .Columns[0].Text = "No"
      .Columns[1].Text = "Date"
      .Columns[2].Text = "Particular"
      .Columns[3].Text = "Sale QTY"
      .Columns[4].Text = "Ret QTY"

    Else If $strType = "PatientSearch" Then
      .Columns[0].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[1].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(180 * modBasic.$AppWidthRatio) & "px"
      .Columns[3].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[4].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"

      .Columns[0].Text = "Encounter"
      .Columns[1].Text = "Registration"
      .Columns[2].Text = "DORec"
      .Columns[3].Text = "Status"
      .Columns[4].Text = "Consult"

    Else If $strType = "Billing:SelectedInvoice" Then
      .Columns[0].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[1].Width = CStr(275 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[3].Width = CStr(50 * modBasic.$AppWidthRatio) & "px"
      .Columns[4].Width = CStr(50 * modBasic.$AppWidthRatio) & "px"
      .Columns[5].Width = CStr(50 * modBasic.$AppWidthRatio) & "px"
      .Columns[6].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[7].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"
      .Columns[8].Hidden = True
      .Columns[9].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"

      .Columns[0].Text = "EncID"
      .Columns[1].Text = "Particulars"
      .Columns[2].Text = "Rate"
      .Columns[3].Text = "QTY"
      .Columns[4].Text = "Tax%"
      .Columns[5].Text = "Disc%"
      .Columns[6].Text = "Total"
      .Columns[7].Text = "EntryDate"
      .Columns[9].Text = "Invoice"

    Else If $strType = "AccGroup:Missing" Or If $strType = "AccGroup:Deleted" Or If $strType = "ItemGroup:Missing" Then
      .Columns[0].Width = CStr(400 * modBasic.$AppWidthRatio) & "px"
      .Columns[1].Width = CStr(200 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"

      .Columns[0].Text = "Particulars"
      .Columns[1].Text = "Category"
      .Columns[2].Text = "Rate"

    Else If $strType = "AccGroup:Duplicates" Then
      .Columns[0].Width = CStr(350 * modBasic.$AppWidthRatio) & "px"
      .Columns[1].Width = CStr(200 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"
      .Columns[3].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"

      .Columns[0].Text = "Particulars"
      .Columns[1].Text = "Category"
      .Columns[2].Text = "Category"
      .Columns[3].Text = "Count"

    Else If $strType = "PatientEncounters" Then
      .Columns[1].Width = CStr(175 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[3].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[4].Width = CStr(175 * modBasic.$AppWidthRatio) & "px"
      .Columns[5].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"

      .Columns[0].Text = "Encounter"
      .Columns[1].Text = "DORec"
      .Columns[2].Text = "Status"
      .Columns[3].Text = "LastLocat"
      .Columns[4].Text = "Consultant"
      .Columns[5].Text = "Package"

    Else If $strType = "PatientRemoteEncounters" Then
      .Columns[0].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[1].Width = CStr(175 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[3].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[4].Width = CStr(175 * modBasic.$AppWidthRatio) & "px"
      .Columns[5].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"

      .Columns[0].Text = "Encounter"
      .Columns[1].Text = "DORec"
      .Columns[2].Text = "Status"
      .Columns[3].Text = "LastLocat"
      .Columns[4].Text = "Consultant"
      .Columns[5].Text = "Hospital"

    Else If $strType = "Transaction:Purchase" Then
      .Columns[0].Width = CStr(200 * modBasic.$AppWidthRatio) & "px"
      .Columns[1].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(275 * modBasic.$AppWidthRatio) & "px"
      .Columns[3].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
      .Columns[4].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
      .Columns[5].Width = CStr(50 * modBasic.$AppWidthRatio) & "px"
      .Columns[6].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[7].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"
      .Columns[8].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[9].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[10].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
      .Columns[11].Hidden = True

      .Columns[0].Text = "Supplier"
      .Columns[1].Text = "Payment"
      .Columns[2].Text = "Particulars"
      .Columns[3].Text = "SupRate"
      .Columns[4].Text = "NetRate"
      .Columns[5].Text = "QTY"
      .Columns[6].Text = "Total"
      .Columns[7].Text = "DateTime"
      .Columns[8].Text = "Invoice"
      .Columns[9].Text = "Reference"
      .Columns[10].Text = "CompID"

    Else If $strType = "Transaction:Consume" Then
      .Columns[0].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[1].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(275 * modBasic.$AppWidthRatio) & "px"
      .Columns[3].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
      .Columns[4].Width = CStr(50 * modBasic.$AppWidthRatio) & "px"
      .Columns[5].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[6].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"
      .Columns[7].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[8].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
      .Columns[9].Hidden = True

      .Columns[0].Text = "Target"
      .Columns[1].Text = "Category"
      .Columns[2].Text = "Particulars"
      .Columns[3].Text = "Rate"
      .Columns[4].Text = "QTY"
      .Columns[5].Text = "Total"
      .Columns[6].Text = "DateTime"
      .Columns[7].Text = "Reference"
      .Columns[8].Text = "CompID"

    Else If $strType = "Transaction:Dispensed" Then
      .Columns[0].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[1].Width = CStr(175 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(275 * modBasic.$AppWidthRatio) & "px"
      .Columns[3].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
      .Columns[4].Width = CStr(50 * modBasic.$AppWidthRatio) & "px"
      .Columns[5].Width = CStr(50 * modBasic.$AppWidthRatio) & "px"
      .Columns[6].Width = CStr(50 * modBasic.$AppWidthRatio) & "px"
      .Columns[7].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[8].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"
      .Columns[9].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[10].Width = CStr(300 * modBasic.$AppWidthRatio) & "px"
      .Columns[11].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
      .Columns[12].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
      .Columns[13].Hidden = True

      .Columns[0].Text = "Encounter"
      .Columns[1].Text = "Patient Name"
      .Columns[2].Text = "Particulars"
      .Columns[3].Text = "Rate"
      .Columns[4].Text = "QTY"
      .Columns[5].Text = "Disc%"
      .Columns[6].Text = "Tax%"
      .Columns[7].Text = "Total"
      .Columns[8].Text = "DateTime"
      .Columns[9].Text = "Invoice"
      .Columns[10].Text = "Item Name"
      .Columns[11].Text = "Order"
      .Columns[12].Text = "Sale"

    Else If $strType = "ClaimCodes"
      .Columns[0].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[1].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"
      .Columns[3].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"

      .Columns[0].Text = "Codes"
      .Columns[1].Text = "Encounter"
      .Columns[2].Text = "DateTime"
      .Columns[3].Text = "User"

    Else If $strType = "Invoice/Receipt"
      .Columns[0].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"
      .Columns[1].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
      .Columns[3].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[4].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[5].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
      .Columns[6].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"

      .Columns[0].Text = "DateTime"
      .Columns[1].Text = "Invoice"
      .Columns[2].Text = "Type"
      .Columns[3].Text = "Account"
      .Columns[4].Text = "Reference"
      .Columns[5].Text = "TotalAMT"
      .Columns[6].Text = "Received"

    Else If $strType = "ArchivedReports" Then
      .Columns[0].Hidden = True
      .Columns[1].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[3].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"
      .Columns[4].Width = CStr(250 * modBasic.$AppWidthRatio) & "px"
      .Columns[5].Hidden = True
      .Columns[6].Hidden = True
      .Columns[7].Hidden = True

      .Columns[1].Text = "DateTime"
      .Columns[2].Text = "Encounter"
      .Columns[3].Text = "Title"
      .Columns[4].Text = "Comment"

    Else If $strType = "ArchivedRepoReports" Then
      .Columns[0].Hidden = True
      .Columns[1].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[3].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"
      .Columns[4].Width = CStr(200 * modBasic.$AppWidthRatio) & "px"
      .Columns[5].Hidden = True
      .Columns[6].Hidden = True
      .Columns[7].Hidden = True
      .Columns[8].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
      .Columns[9].Width = CStr(25 * modBasic.$AppWidthRatio) & "px"

      .Columns[1].Text = "DateTime"
      .Columns[2].Text = "Encounter"
      .Columns[3].Text = "Title"
      .Columns[4].Text = "Comment"
      .Columns[8].Text = "HF"

    Else If $strType = "Pharmacy:Cancelled" Then
      .Columns[0].Hidden = True
      .Columns[1].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(225 * modBasic.$AppWidthRatio) & "px"
      .Columns[3].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
      .Columns[4].Width = CStr(50 * modBasic.$AppWidthRatio) & "px"
      .Columns[5].Width = CStr(50 * modBasic.$AppWidthRatio) & "px"
      .Columns[6].Width = CStr(50 * modBasic.$AppWidthRatio) & "px"
      .Columns[7].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[8].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[9].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[10].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[11].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[12].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"

      .Columns[1].Text = "Req.Date"
      .Columns[2].Text = "Particulars"
      .Columns[3].Text = "Dose"
      .Columns[4].Text = "Freq"
      .Columns[5].Text = "Days"
      .Columns[6].Text = "QTY"
      .Columns[7].Text = "Status"
      .Columns[8].Text = "Cancelled"
      .Columns[9].Text = "Req.Comp"
      .Columns[10].Text = "Disp.User"
      .Columns[11].Text = "Disp.Comp"
      .Columns[12].Text = "Disp.Date"

    Else If $strType = "PurchaseReference" Then
      .Columns[0].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[1].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(275 * modBasic.$AppWidthRatio) & "px"
      .Columns[3].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[4].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[5].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
      .Columns[6].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
      .Columns[7].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
      .Columns[8].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[9].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"

      .Columns[0].Text = "Date"
      .Columns[1].Text = "Category"
      .Columns[2].Text = "Particulars"
      .Columns[3].Text = "Batch"
      .Columns[4].Text = "Expiry"
      .Columns[5].Text = "Rate"
      .Columns[6].Text = "Free"
      .Columns[7].Text = "QTY"
      .Columns[8].Text = "NetCost"
      .Columns[9].Text = "Total"

    Else If $strType = "Telemedicine" Then
      .Columns[0].Hidden = True
      .Columns[1].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(200 * modBasic.$AppWidthRatio) & "px"
      .Columns[3].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[4].Hidden = True
      .Columns[5].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
      .Columns[6].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[7].Width = CStr(200 * modBasic.$AppWidthRatio) & "px"
      .Columns[8].Hidden = True
      .Columns[9].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
      .Columns[10].Hidden = True
      .Columns[11].Hidden = True
      .Columns[12].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[13].Width = CStr(200 * modBasic.$AppWidthRatio) & "px"
      .Columns[14].Hidden = True
      .Columns[15].Hidden = True
      .Columns[16].Hidden = True

      .Columns[1].Text = "EncID"
      .Columns[2].Text = "Name"
      .Columns[3].Text = "Age/Sex"
      .Columns[5].Text = "Hospital"
      .Columns[6].Text = "Urgency"
      .Columns[7].Text = "Query"
      .Columns[9].Text = "User"
      .Columns[12].Text = "DateTime"
      .Columns[13].Text = "Response"

    Endif

  End With

End

Public Sub mnudetreport_Click()

  If GridView1.Selection.Count Then
    $rData.MoveTo(GridView1.Selection[0])
    If $strType = "PatientEncounters" Then
      modPatReports.GetSelectedPatientValues($rData["fldencounterval"], MMain.$defUnit)
    Else If $strType = "PatientRemoteEncounters" Then
      modPatReports.GetSelectedPatientValues($rData["fldencounterval"], MMain.$defUnit)
    Endif
  Endif

End

' Public Sub Form_KeyRelease()
'
'   If Key.Code = Key.Esc Then
'     Me.Close
'   Endif
'
' End

Public Sub btnexport_Click()

  modCHTMLReport.ExportGridToHTML(GridView1, Me.Title, modReportVar.GetDateTimeReport(Now(), gb.GeneralDate))

End

Public Sub mnutransfer_Click()

  ' modGridView.ExportGridToSqlite(GridView1)

End

Public Sub mnubill_Click()

  Dim xPath As String

  If GridView1.Selection.Count Then
    $rData.MoveTo(GridView1.Selection[0])
    xPath = modCHTMLInvoice.ShowTotalInvoicebyPatient($rData["fldencounterval"], "Complete")
    modControlSub.OpenHTMLPreview($rData["fldencounterval"], xPath, "ReportSize")
  Endif

End

Public Sub mnumovement_Click()

  Dim xcoord As String[]
  Dim xList As String[]
  Dim xLink As String

  xList = New String[]
  For Each $rData
    xcoord = modDataRepo.GetGeoCoordinates($rData["fldhospcode"])
    If xcoord Then
      If xcoord[0] And If xcoord[1] Then
        xList.Add(xcoord[0] & "," & xcoord[1])
      Endif
    Endif
  Next
  If xList.Count Then
    xLink = "https://www.google.com/maps/dir/" & xList.Join("/")
    Me.Exec("window.open('" & xLink & "'); ")
  Endif

End

''===================== Images =======================
Public Sub mnugenimage_Click()

  Dim hForm As FmPatImage

  If GridView1.Selection.Count Then
    $rData.MoveTo(GridView1.Selection[0])
    hForm = New FmPatImage("IMAGE", $rData["fldencounterval"], "")
    hForm.ShowModal
  Endif

End

Public Sub mnudicom_Click()

  Dim hForm As FmPatImage

  If GridView1.Selection.Count Then
    $rData.MoveTo(GridView1.Selection[0])
    hForm = New FmPatImage("DICOM", $rData["fldencounterval"], "")
    hForm.ShowModal
  Endif

End

Public Sub mnupacs_Click()

  Dim hForm As FmPacsShow

  If GridView1.Selection.Count Then
    $rData.MoveTo(GridView1.Selection[0])
    hForm = New FmPacsShow($rData["fldencounterval"], "Visit")
    hForm.ShowModal
  Endif

End

''================== Activity =============================
Public Sub mnuopenfile_Click()

  Dim hForm As FmPDFView
  Dim xLink As String

  If GridView1.Selection.Count Then
    $rData.MoveTo(GridView1.Selection[0])

    If $strType = "ArchivedRepoReports" Then
      If MMain.$WebEntry = True Then
        xLink = modImage.GetBlobFileRemoteData($rData["fldrepoid"])
      Else
        xLink = modImage.GetBlobFileRemoteData($rData["fldid"])
      Endif
    Else
      xLink = modImage.GetBlobFileData($rData["fldid"])
    Endif
    If xLink Then
      hForm = New FmPDFView(xLink, False, $rData["fldencounterval"])
      hForm.ShowModal
    Endif

  Endif

End

Public Sub mnuprint_Click()

  Dim xLink As String

  If GridView1.Selection.Count Then
    $rData.MoveTo(GridView1.Selection[0])

    If $strType = "ArchivedRepoReports" Then
      If MMain.$WebEntry = True Then
        xLink = modImage.GetBlobFileRemoteData($rData["fldrepoid"])
      Else
        xLink = modImage.GetBlobFileRemoteData($rData["fldid"])
      Endif
    Else
      xLink = modImage.GetBlobFileData($rData["fldid"])
    Endif
    If xLink Then
      Me.Exec("printJS('" & modPrint.GetFileWebURL(xLink) & "')")
    Endif

  Endif

End

Public Sub mnuemail_Click()

  Dim xLink As String
  Dim hForm As FmRemoteMail
  Dim xx As String

  If GridView1.Selection.Count Then
    $rData.MoveTo(GridView1.Selection[0])

    If $strType = "ArchivedRepoReports" Then
      If MMain.$WebEntry = True Then
        xLink = modImage.GetBlobFileRemoteData($rData["fldrepoid"])
      Else
        xLink = modImage.GetBlobFileRemoteData($rData["fldid"])
      Endif
    Else
      xLink = modImage.GetBlobFileData($rData["fldid"])
    Endif
    If xLink Then
      xx = modPatient.GetPatientEmail($rData["fldencounterval"])
      hForm = New FmRemoteMail(xx, xLink, "Report", $rData["fldtitle"])
      hForm.ShowModal()
    Endif

  Endif

End

Public Sub mnuftp_Click()

  Dim xx As String
  Dim xpath As String
  Dim xLink As String

  If GridView1.Selection.Count Then
    $rData.MoveTo(GridView1.Selection[0])

    If modBasic.$RepoManHost And If modBasic.$RepoManFolder And If modBasic.$RepoManUser Then

      If $strType = "ArchivedRepoReports" Then
        If MMain.$WebEntry = True Then
          xLink = modImage.GetBlobFileRemoteData($rData["fldrepoid"])
        Else
          xLink = modImage.GetBlobFileRemoteData($rData["fldid"])
        Endif
      Else
        xLink = modImage.GetBlobFileData($rData["fldid"])
      Endif
      If xLink Then
        xpath = modString.GetNowString() & ".pdf"
        xx = modDevAll.SendFileToFTP(modBasic.$RepoManHost, modBasic.$RepoManFolder &/ modBasic.$lbluser, modBasic.$RepoManUser, modBasic.$RepoManPass, xpath, xLink)
        If xx Then
          Message.Warning(xx, ("OK"))
        Else
          Message.Info("Upload file is" & "<br>" & xpath, ("OK"))
        Endif
      Endif

    Endif

  Endif

End

Public Sub GridView1_Click(Row As Integer, Column As Integer)

  Dim hForm As FmPDFView
  Dim xLink As String

  If Column = 9 Then
    If $strType = "ArchivedRepoReports" Then
      $rData.MoveTo(Row)
      If MMain.$WebEntry = True Then
        xLink = modImage.GetBlobFileRemoteData($rData["fldrepoid"])
      Else
        xLink = modImage.GetBlobFileRemoteData($rData["fldid"])
      Endif
      If xLink Then
        hForm = New FmPDFView(xLink, False, $rData["fldencounterval"])
        hForm.Show
      Endif
    Endif
  Endif

End
