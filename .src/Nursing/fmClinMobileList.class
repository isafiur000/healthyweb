' Gambas class file

Private $UserRestrict As String[]
Private asx As String

Private $sInput As String

Public Sub _new(sInput As String)

  $sInput = sInput

  If $sInput = "Location" Then
    txtlabel.Text = "BedNo"
  Else If $sInput = "Encounter" Then
    txtlabel.Text = "EncID"
  Endif
  modBasic.$TabletModeEnable = "Yes"
  $UserRestrict = modBasic.$ClinicDisableCompo
  If modHelpVariable.$LogInCategory = "Clinician" Then
    GetComboItemList()
    WebContainer2.Visible = True
  Endif

End

Public Sub WebContainer6_Render()

  Print "<div id='my-qr-reader'></div>"

End

Public Sub WebTimer1_Timer()

  WebTimer1.Enabled = False
  WebForm.Current.Reload()

End

Public Sub btncopy_Click()

  txtvalue.SetFocus
  asx = "$_(" & JS(txtvalue.Name & ":entry") & ").value = qrvalue;"
  asx = asx & " gw.update(" & JS(txtvalue.Name) & ", 'text', qrvalue);"
  Me.Exec(asx)

End

Public Sub btnshow_Click()

  BasicProfile()
  btncopy.Enabled = False

End

Public Sub btnclear_Click()

  btncopy.Enabled = True
  txtencid.Text = ""
  txtpatientname.Text = ""
  txtvalue.Text = ""

End

''---------------------------- Patient ---------------------------------------
Private Sub BasicProfile()

  If txtvalue.Text Then
    If $sInput = "Location" Then
      txtencid.Text = modGeneral.GetEncounterFromBed(Trim(txtvalue.Text))
    Else If $sInput = "Encounter" Then
      txtencid.Text = Trim(txtvalue.Text)
    Endif
  Endif

  If txtencid.Text Then
    txtpatientname.Text = modPatient.GetPatientNameByEnc(Trim(txtencid.Text))
  Endif

End

Private Sub GetComboItemList()

  If $UserRestrict.Exist("Essential Examinations") = False Then
    btnmobilevital.Visible = True
  Endif
  If $UserRestrict.Exist("Medicine Dosing") = False Then
    btndosing.Visible = True
  Endif
  If $UserRestrict.Exist("IV Infusion") = False Then
    btnmobivfl.Visible = True
  Endif
  If $UserRestrict.Exist("Equipments Used") = False Then
    btnmobequip.Visible = True
  Endif
  If $UserRestrict.Exist("General Images") = False Then
    btnmobileimage.Visible = True
  Endif
  If $UserRestrict.Exist("Devices Used") = False Then
    btnmobevent.Visible = True
  Endif
  If $UserRestrict.Exist("Clinical Notes") = False Then
    btnmobnote.Visible = True
  Endif

  If $UserRestrict.Exist("Laboratory Request") = False Then
    btnlabs.Visible = True
  Endif
  If $UserRestrict.Exist("Radiology Request") = False Then
    btnradio.Visible = True
  Endif
  If $UserRestrict.Exist("Pharmacy Request") = False Then
    btnpharm.Visible = True
  Endif
  If $UserRestrict.Exist("Provisional Diagnosis") = False Then
    btnmobileimage.Visible = True
  Endif

End

Public Sub btnmobevent_Click()

  Dim hForm9 As FmDeviceUse

  If txtpatientname.Text Then
    hForm9 = New FmDeviceUse(Trim(txtencid.Text), "Devices")
    hForm9.ShowModal
  Endif

End

Public Sub btnmobilevital_Click()

  Dim hForm As FmVItalMobile

  If txtpatientname.Text Then
    hForm = New FmVItalMobile(Trim(txtencid.Text))
    hForm.ShowModal
  Endif

End

Public Sub btndosing_Click()

  Dim hForm4 As FmDoseMobile

  If txtpatientname.Text Then
    hForm4 = New FmDoseMobile(Trim(txtencid.Text))
    hForm4.ShowModal
  Endif

End

Public Sub btnmobileimage_Click()

  Dim hForm4 As FmImageLoad

  If txtpatientname.Text Then
    hForm4 = New FmImageLoad("IMAGE", Trim(txtencid.Text))
    hForm4.ShowModal
  Endif

End

Public Sub btnmobnote_Click()

  Dim hForm As FmMobileForm

  If txtpatientname.Text Then
    hForm = New FmMobileForm(Trim(txtencid.Text), "Notes")
    hForm.ShowModal
  Endif

End

Public Sub btnlabs_Click()

  Dim hForm10 As FmTestList

  If txtpatientname.Text Then
    If modNonMedical.AllowEntryWithDeposit(Trim(txtencid.Text), "Test") = True Then
      hForm10 = New FmTestList(Trim(txtencid.Text), modNonMedical.GetAutoIPBillingPack("Test", Trim(txtencid.Text)))
      hForm10.ShowModal
    Endif
  Endif

End

Public Sub btnradio_Click()

  Dim hForm11 As FmRadioList

  If txtpatientname.Text Then
    If modNonMedical.AllowEntryWithDeposit(Trim(txtencid.Text), "Radio") = True Then
      hForm11 = New FmRadioList(Trim(txtencid.Text), modNonMedical.GetAutoIPBillingPack("Radio", Trim(txtencid.Text)))
      hForm11.ShowModal
    Endif
  Endif

End

Public Sub btnpharm_Click()

  Dim hForm As FmMobileForm

  If txtpatientname.Text Then
    If modNonMedical.AllowEntryWithDeposit(Trim(txtencid.Text), "Pharmacy") = True Then
      hForm = New FmMobileForm(Trim(txtencid.Text), "Ward Stock")
      hForm.ShowModal
    Endif
  Endif

End

Public Sub btnmobequip_Click()

  Dim hForm6 As FmEquipment

  If txtpatientname.Text Then
    If modNonMedical.AllowEntryWithDeposit(Trim(txtencid.Text), "Equipment") = True Then
      hForm6 = New FmEquipment(Trim(txtencid.Text), modNonMedical.GetAutoIPBillingPack("Equipment", Trim(txtencid.Text)))
      hForm6.ShowModal
    Endif
  Endif

End

Public Sub btnmobivfl_Click()

  Dim hForm18 As FmIVInfusion

  If txtpatientname.Text Then
    hForm18 = New FmIVInfusion(Trim(txtencid.Text))
    hForm18.ShowModal
  Endif

End
