' Gambas class file

Private $UserRestrict As String[]
Private asx As String

Public Sub _new()

  $UserRestrict = modBasic.$ClinicDisableCompo
  If modHelpVariable.$LogInCategory = "Clinician" Then
    GetComboItemList()
    WebContainer2.Visible = True
  Endif

End

Public Sub WebContainer6_Render()

  Print "<div id='my-qr-reader'></div>"

End

Public Sub WebTimer1_Timer()

  WebTimer1.Enabled = False
  WebForm.Current.Reload()

End

Public Sub btncopy_Click()

  txtbedno.SetFocus
  asx = "$_(" & JS(txtbedno.Name & ":entry") & ").value = qrvalue;"
  asx = asx & " gw.update(" & JS(txtbedno.Name) & ", 'text', qrvalue);"
  Me.Exec(asx)

End

Public Sub btnshow_Click()

  If txtbedno.Text Then
    BasicProfile()
    btncopy.Enabled = False
  Endif

End

Public Sub btnclear_Click()

  btncopy.Enabled = True
  txtencid.Text = ""
  txtpatientname.Text = ""
  txtbedno.Text = ""

End

''---------------------------- Patient ---------------------------------------
Private Sub BasicProfile()

  txtencid.Text = modGeneral.GetEncounterFromBed(Trim(txtbedno.Text))
  If txtencid.Text Then
    txtpatientname.Text = modPatient.GetPatientNameByEnc(Trim(txtencid.Text))
  Endif

End

Private Sub GetComboItemList()

  If $UserRestrict.Exist("Essential Examinations") = False Then
    btnmobilevital.Visible = True
  Endif
  If $UserRestrict.Exist("Medicine Dosing") = False Then
    btndosing.Visible = True
  Endif
  If $UserRestrict.Exist("IV Infusion") = False Then
    btnmobivfl.Visible = True
  Endif
  If $UserRestrict.Exist("Equipments Used") = False Then
    btnmobequip.Visible = True
  Endif
  If $UserRestrict.Exist("General Images") = False Then
    btnmobimage.Visible = True
  Endif
  If $UserRestrict.Exist("Devices Used") = False Then
    btnmobevent.Visible = True
  Endif
  If $UserRestrict.Exist("Clinical Notes") = False Then
    btnmobnote.Visible = True
  Endif

  If $UserRestrict.Exist("Laboratory Request") = False Then
    btnlabs.Visible = True
  Endif
  If $UserRestrict.Exist("Radiology Request") = False Then
    btnradio.Visible = True
  Endif
  If $UserRestrict.Exist("Pharmacy Request") = False Then
    btnpharm.Visible = True
  Endif
  If $UserRestrict.Exist("Provisional Diagnosis") = False Then
    btnmobilediagno.Visible = True
  Endif

End

Public Sub btnmobevent_Click()

  Dim hForm9 As FmDeviceUse

  If txtencid.Text Then
    hForm9 = New FmDeviceUse(Trim(txtencid.Text), "Devices")
    hForm9.ShowModal
  Endif

End

Public Sub btnmobilevital_Click()

  Dim hForm As FmVItalMobile

  If txtencid.Text Then
    hForm = New FmVItalMobile(Trim(txtencid.Text))
    hForm.ShowModal
  Endif

End

Public Sub btndosing_Click()

  Dim hForm4 As FmDoseMobile

  If txtencid.Text Then
    hForm4 = New FmDoseMobile(Trim(txtencid.Text))
    hForm4.ShowModal
  Endif

End

Public Sub btnmobilediagno_Click()

  Dim sName As String[]

  If txtencid.Text Then
    If MMain.$Ayurveda = "Yes" Then
      sName = AyurvedicDiagnosis(modAyurv.$AyurvedicDiagnosis)
    Else
      sName = ICDTree(modDatabase.$icdConn, "Disease", modBasic.$ClinDiagnoChapterGrouped, modBasic.$FixDiagnoGroupOPD, modBasic.$FixDiagnoGroupER, modBasic.$ClinDiagnoSelectGrouped, modBasic.$ClinDiagnoSelectERGroup)
    Endif
    If sName Then
      If sName[1] And If sName[0] Then
        modPatientGeneral.AddPatientFindings("Provisional Diagnosis", Trim(txtencid.Text), sName[0], sName[1], sName[2])
        Me.Exec(Subst("Toastify({text: '&1', duration: &2}).showToast()", "Information saved", modBasic.$BalloonDelay))
      Endif
    Endif
  Endif

End

Public Sub btnmobnote_Click()

  Dim hForm As FmMobileForm

  If txtencid.Text Then
    hForm = New FmMobileForm(Trim(txtencid.Text), "Notes")
    hForm.ShowModal
  Endif

End

Public Sub btnmobimage_Click()

  Dim hForm8 As FmPatImage

  If txtencid.Text Then
    hForm8 = New FmPatImage("IMAGE", Trim(txtencid.Text), "")
    hForm8.ShowModal
  Endif

End

Public Sub btnlabs_Click()

  Dim hForm10 As FmTestList

  If txtencid.Text Then
    If modNonMedical.AllowEntryWithDeposit(Trim(txtencid.Text), "Test") = True Then
      hForm10 = New FmTestList(Trim(txtencid.Text), modNonMedical.GetAutoIPBillingPack("Test", Trim(txtencid.Text)))
      hForm10.ShowModal
    Endif
  Endif

End

Public Sub btnradio_Click()

  Dim hForm11 As FmRadioList

  If txtencid.Text Then
    If modNonMedical.AllowEntryWithDeposit(Trim(txtencid.Text), "Radio") = True Then
      hForm11 = New FmRadioList(Trim(txtencid.Text), modNonMedical.GetAutoIPBillingPack("Radio", Trim(txtencid.Text)))
      hForm11.ShowModal
    Endif
  Endif

End

Public Sub btnpharm_Click()

  Dim hForm As FmMobileForm

  If txtencid.Text Then
    If modNonMedical.AllowEntryWithDeposit(Trim(txtencid.Text), "Pharmacy") = True Then
      hForm = New FmMobileForm(Trim(txtencid.Text), "Ward Stock")
      hForm.ShowModal
    Endif
  Endif

End

Public Sub btnmobequip_Click()

  Dim hForm6 As FmEquipment

  If txtencid.Text Then
    If modNonMedical.AllowEntryWithDeposit(Trim(txtencid.Text), "Equipment") = True Then
      hForm6 = New FmEquipment(Trim(txtencid.Text), modNonMedical.GetAutoIPBillingPack("Equipment", Trim(txtencid.Text)))
      hForm6.ShowModal
    Endif
  Endif

End

Public Sub btnmobivfl_Click()

  Dim hForm18 As FmIVInfusion

  If txtencid.Text Then
    hForm18 = New FmIVInfusion(Trim(txtencid.Text))
    hForm18.ShowModal
  Endif

End
