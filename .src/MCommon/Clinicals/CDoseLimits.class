' Gambas class file

Private $encid As String
Private $codeID As String

Private $PatSex As String
Private $PatAgeGrp As String

Private $MaxUnitDose As Float
Private $MaxDayDose As Float
Private $MinDayDose As Float
Private $MaxFrequecy As Integer

Public Sub _new(encid As String, codeid As String)

  $encid = encid
  $codeID = codeid

  $PatSex = modPatient.GetPatientSex($encid)
  $PatAgeGrp = modPatient.GetAgeGroupFIxed($encid, Now())

  GetDosingLimits()

End

''--------------- code limits ----------------------------
Private Sub GetDosingLimits()

  Dim sql As String
  Dim res As Result

  sql = "select fldmaxundose,fldmaxundoseunit,fldmaxdaladdose,fldmaxdaladdoseunit,fldmindaladdose,fldmindaladdoseunit,fldmaxfreq from tblcodelimit where fldcodename=&1 and (fldptsex=&2 or fldptsex=&3) and (fldagegroup=&4 or fldagegroup=&5)"
  res = modDatabase.$medConn.Exec(sql, $codeID, $PatSex, "Both Sex", $PatAgeGrp, "All Age")
  If res.Available Then
    If res["fldmaxundose"] Then
      $MaxUnitDose = modMedDosing.GetDoseInMg(res["fldmaxundose"], res["fldmaxundoseunit"], $encid)
    Else
      $MaxUnitDose = 0
    Endif
    If res["fldmaxdaladdose"] Then
      $MaxDayDose = modMedDosing.GetDoseInMg(res["fldmaxdaladdose"], res["fldmaxdaladdoseunit"], $encid)
    Else
      $MaxDayDose = 0
    Endif
    If res["fldmindaladdose"] Then
      $MinDayDose = modMedDosing.GetDoseInMg(res["fldmindaladdose"], res["fldmindaladdoseunit"], $encid)
    Else
      $MinDayDose = 0
    Endif
    If res["fldmaxfreq"] Then
      $MaxFrequecy = res["fldmaxfreq"]
    Else
      $MaxFrequecy = 0
    Endif

  Else
    $MaxUnitDose = 0
    $MaxDayDose = 0
    $MinDayDose = 0
    $MaxFrequecy = 0
  Endif

End

Public Function GetMaxUnitDose() As Float

  Return $MaxUnitDose

End

Public Function GetMaxDailyDose() As Float

  Return $MaxDayDose

End

Public Function GetMinDailyDose() As Float

  Return $MinDayDose

End

Public Function GetMaxFrequency() As Integer

  Return $MaxFrequecy

End
