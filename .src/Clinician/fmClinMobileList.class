' Gambas class file

Private $UserRestrict As String[]
Private asx As String

Public Sub _new()

  $UserRestrict = modBasic.$ClinicDisableCompo
  If modHelpVariable.$LogInCategory = "Clinician" Then
    GetComboItemList()
    WebContainer2.Visible = True
    WebContainer16.Visible = True
  Endif

End

Public Sub WebContainer6_Render()

  Print "<div id='my-qr-reader'></div>"

End

Public Sub WebTimer1_Timer()

  WebTimer1.Enabled = False
  WebForm.Current.Reload()

End

Public Sub btncopy_Click()

  txtbedno.SetFocus
  asx = "$_(" & JS(txtbedno.Name & ":entry") & ").value = qrvalue;"
  asx = asx & " gw.update(" & JS(txtbedno.Name) & ", 'text', qrvalue);"
  Me.Exec(asx)

End

Public Sub btnshow_Click()

  If txtbedno.Text Then
    BasicProfile()
    btncopy.Enabled = False
  Endif

End

Public Sub btnclear_Click()

  btncopy.Enabled = True
  txtencid.Text = ""
  txtpatientname.Text = ""
  txtgender.Text = ""
  txtpatientaddress.Text = ""
  txtbedno.Text = ""

End

''---------------------------- Patient ---------------------------------------
Private Sub BasicProfile()

  txtencid.Text = modGeneral.GetEncounterFromBed(Trim(txtbedno.Text))
  If txtencid.Text Then
    txtpatientname.Text = modPatient.GetPatientNameByEnc(Trim(txtencid.Text))
    txtgender.Text = modPatient.GetPatientAgeString(Trim(txtencid.Text), Now()) & "/" & Left(modPatient.GetPatientSex(Trim(txtencid.Text)), 1)
    txtpatientaddress.Text = modPatient.GetPatientAddressByEnc(Trim(txtencid.Text))
  Endif

End

Private Sub GetComboItemList()

  If $UserRestrict.Exist("Patient History") = False Then
    btnall.Visible = True
  Endif
  If $UserRestrict.Exist("Demographics") = False Then
    btnmobiledemog.Visible = True
  Endif
  If $UserRestrict.Exist("Essential Examinations") = False Then
    btnmobilevital.Visible = True
  Endif
  If $UserRestrict.Exist("Medicine Dosing") = False Then
    btndosing.Visible = True
  Endif
  If $UserRestrict.Exist("IV Infusion") = False Then
    btnmobivfl.Visible = True
  Endif
  If $UserRestrict.Exist("General Services") = False Then
    btnbilling.Visible = True
  Endif
  If $UserRestrict.Exist("Minor Procedure") = False Then
    btnmobminor.Visible = True
  Endif
  If $UserRestrict.Exist("Equipments Used") = False Then
    btnmobequip.Visible = True
  Endif
  If $UserRestrict.Exist("General Images") = False Then
    btnmobimage.Visible = True
    btndraw.Visible = True    ''''(incomplete)
  Endif
  If $UserRestrict.Exist("Video Data") = False Then
    btnvideo.Visible = True
  Endif
  If $UserRestrict.Exist("PACS Images") = False Then
    btnmobpacs.Visible = True
  Endif
  If $UserRestrict.Exist("Devices Used") = False Then
    btnmobevent.Visible = True
  Endif
  If $UserRestrict.Exist("Clinical Findings") = False Then
    btnmobexam.Visible = True
    btnmobexamall.Visible = True
  Endif
  If $UserRestrict.Exist("Clinical Notes") = False Then
    btnmobnote.Visible = True
  Endif

  If $UserRestrict.Exist("Laboratory Request") = False Then
    btnlabs.Visible = True
  Endif
  If $UserRestrict.Exist("Radiology Request") = False Then
    btnradio.Visible = True
  Endif
  If $UserRestrict.Exist("Pharmacy Request") = False Then
    btnpharm.Visible = True
  Endif
  If $UserRestrict.Exist("PO Intake Plan") = False Then
    btndiet.Visible = True
  Endif
  If $UserRestrict.Exist("Provisional Diagnosis") = False Then
    btnmobilediagno.Visible = True
    btnobsdiagno.Visible = True
  Endif

End

Public Sub btnmobilebed_Click()

  If txtencid.Text Then
    txtbedno.Text = GetBedNumber(Trim(txtencid.Text))
  Endif

End

Public Sub btnmobevent_Click()

  Dim hForm9 As FmDeviceUse

  If txtencid.Text Then
    hForm9 = New FmDeviceUse(Trim(txtencid.Text), "Devices")
    hForm9.ShowModal
  Endif

End

Public Sub btnmobilevital_Click()

  Dim hForm As FmVItalMobile

  If txtencid.Text Then
    hForm = New FmVItalMobile(Trim(txtencid.Text))
    hForm.ShowModal
  Endif

End

Public Sub btndosing_Click()

  Dim hForm4 As FmDoseMobile

  If txtencid.Text Then
    hForm4 = New FmDoseMobile(Trim(txtencid.Text))
    hForm4.ShowModal
  Endif

End

Public Sub btnmobilediagno_Click()

  Dim sName As String[]

  If txtencid.Text Then
    If MMain.$Ayurveda = "Yes" Then
      sName = AyurvedicDiagnosis(modAyurv.$AyurvedicDiagnosis)
    Else
      sName = ICDTree(modDatabase.$icdConn, "Disease", modBasic.$ClinDiagnoChapterGrouped, modBasic.$FixDiagnoGroupOPD, modBasic.$FixDiagnoGroupER, modBasic.$ClinDiagnoSelectGrouped, modBasic.$ClinDiagnoSelectERGroup)
    Endif
    If sName Then
      If sName[1] And If sName[0] Then
        modPatientGeneral.AddPatientFindings("Provisional Diagnosis", Trim(txtencid.Text), sName[0], sName[1], sName[2])
        Me.Exec(Subst("Toastify({text: '&1', duration: &2}).showToast()", "Information saved", modBasic.$BalloonDelay))
      Endif
    Endif
  Endif

End

Public Sub btnall_Click()

  Dim hForm As FmHistoryMobile

  If txtencid.Text Then
    hForm = New FmHistoryMobile(Trim(txtencid.Text))
    hForm.ShowModal
  Endif

End

Public Sub btnmobnote_Click()

  Dim hForm As FmMobileForm

  If txtencid.Text Then
    hForm = New FmMobileForm(Trim(txtencid.Text), "Notes")
    hForm.ShowModal
  Endif

End

Public Sub btnmobexamall_Click()

  Dim hForm21 As FmEnterGroupExam

  If txtencid.Text Then
    hForm21 = New FmEnterGroupExam(Trim(txtencid.Text), "Physician Examinations", "All")
    hForm21.ShowModal
  Endif

End

Public Sub btnmobexam_Click()

  Dim hForm As FmEnterGroupExam
  Dim hForm1 As FmEnterDepartExam

  If txtencid.Text Then
    If modBasic.$ClinIPDExamination Then
      hForm1 = New FmEnterDepartExam(modBasic.$ClinIPDExamination, Trim(txtencid.Text), modBasic.$ClinIPDExamination, "Physician Examinations")
      hForm1.ShowModal
    Else
      hForm = New FmEnterGroupExam(Trim(txtencid.Text), "Physician Examinations", "Group")
      hForm.ShowModal
    Endif
  Endif

End

Public Sub btnmobiledemog_Click()

  Dim hForm7 As FmPatdemograph

  If txtencid.Text Then
    hForm7 = New FmPatdemograph(Trim(txtencid.Text), "Clinical")
    hForm7.ShowModal
  Endif

End

Public Sub btnmobimage_Click()

  Dim hForm8 As FmPatImage

  If txtencid.Text Then
    hForm8 = New FmPatImage("IMAGE", Trim(txtencid.Text), "")
    hForm8.ShowModal
  Endif

End

Public Sub btnlabs_Click()

  Dim hForm10 As FmTestList

  If txtencid.Text Then
    If modNonMedical.AllowEntryWithDeposit(Trim(txtencid.Text), "Test") = True Then
      hForm10 = New FmTestList(Trim(txtencid.Text), modNonMedical.GetAutoIPBillingPack("Test", Trim(txtencid.Text)))
      hForm10.ShowModal
    Endif
  Endif

End

Public Sub btnradio_Click()

  Dim hForm11 As FmRadioList

  If txtencid.Text Then
    If modNonMedical.AllowEntryWithDeposit(Trim(txtencid.Text), "Radio") = True Then
      hForm11 = New FmRadioList(Trim(txtencid.Text), modNonMedical.GetAutoIPBillingPack("Radio", Trim(txtencid.Text)))
      hForm11.ShowModal
    Endif
  Endif

End

Public Sub btnpharm_Click()

  Dim hForm12 As FmMedOrder

  If txtencid.Text Then
    If modNonMedical.AllowEntryWithDeposit(Trim(txtencid.Text), "Pharmacy") = True Then
      If modBasic.$MedRequestForm = "Separate" Then
      Else
        hForm12 = New FmMedOrder(Trim(txtencid.Text), "Admitted", modNonMedical.GetAutoIPBillingPack("Pharmacy", Trim(txtencid.Text)))
        hForm12.ShowModal
      Endif
    Endif
  Endif

End

Public Sub btndiet_Click()

  Dim hForm15 As FmFoodPlan

  If txtencid.Text Then
    hForm15 = New FmFoodPlan(Trim(txtencid.Text))
    hForm15.ShowModal
  Endif

End

Public Sub btnIPform_Click()

  Dim hForm As FmPatientMain

  If txtencid.Text Then
    Me.Parent.DeleteChildren()
    modGeneralMain.$FormOpenList.Add(["fmClinBedList"])
    hForm = New FmPatientMain(Trim(txtencid.Text), fmOfficer.Workspace1)
  Endif

End

Public Sub btndraw_Click()

  Dim ximg As String
  Dim xval As String

  If txtencid.Text Then
    ximg = CustomDraw()
    If ximg Then
      xval = modImage.SaveClinicScreenDraw(Trim(txtencid.Text), modString.GetDateString(Now()), ximg)
    Endif
  Endif

End

Public Sub btnmobpacs_Click()

  Dim hForm As FmPacsShow

  If txtencid.Text Then
    hForm = New FmPacsShow(Trim(txtencid.Text), "Visit")
    hForm.ShowModal
  Endif

End

Public Sub btnmobequip_Click()

  Dim hForm6 As FmEquipment

  If txtencid.Text Then
    If modNonMedical.AllowEntryWithDeposit(Trim(txtencid.Text), "Equipment") = True Then
      hForm6 = New FmEquipment(Trim(txtencid.Text), modNonMedical.GetAutoIPBillingPack("Equipment", Trim(txtencid.Text)))
      hForm6.ShowModal
    Endif
  Endif

End

Public Sub btnmobminor_Click()

  Dim hForm5 As FmMiniProcedure

  If txtencid.Text Then
    If modNonMedical.AllowEntryWithDeposit(Trim(txtencid.Text), "Procedure") = True Then
      hForm5 = New FmMiniProcedure(Trim(txtencid.Text), modNonMedical.GetAutoIPBillingPack("Procedure", Trim(txtencid.Text)))
      hForm5.ShowModal
    Endif
  Endif

End

Public Sub btnmobivfl_Click()

  Dim hForm18 As FmIVInfusion

  If txtencid.Text Then
    hForm18 = New FmIVInfusion(Trim(txtencid.Text))
    hForm18.ShowModal
  Endif

End

Public Sub btnbilling_Click()

  Dim hForm14 As FmMiniService
  Dim xservmode As String
  Dim xprocmode As String
  Dim xothermode As String

  If txtencid.Text Then
    xservmode = modNonMedical.GetAutoIPBillingPack("Service", Trim(txtencid.Text))
    xprocmode = modNonMedical.GetAutoIPBillingPack("Procedure", Trim(txtencid.Text))
    xothermode = modNonMedical.GetAutoIPBillingPack("Others", Trim(txtencid.Text))
    hForm14 = New FmMiniService(Trim(txtencid.Text), xservmode, xprocmode, xothermode)
    hForm14.ShowModal
  Endif

End

Public Sub btnvideo_Click()

  Dim hForm8 As FmPatVideo

  If txtencid.Text Then
    hForm8 = New FmPatVideo("VIDEO", Trim(txtencid.Text), "")
    hForm8.ShowModal
  Endif

End
