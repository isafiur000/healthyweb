' Gambas class file

Private $rData6 As Result
Private $aMyFields6 As String[]
Private $rData9 As Result
Private $aMyFields9 As String[]
Private $rData10 As Result
Private $aMyFields10 As String[]

Private xGridData1 As Variant[]
Private xGridData2 As Variant[]
Private xGridData3 As Variant[]
Private xGridData4 As Variant[]
Private xGridData5 As Variant[]
Private xGridData8 As Variant[]

Public Sub _new()

  If MMain.$WebReport = "Multiple" Then
    If modBasic.$HospCode Then
      ' cmblocation.Text = "Hospital"
      cmblocation.Text = modDataRepo.$RepositoryMode
      cmbvalue.Text = modBasic.$HospCode
      Panel13.Enabled = False
    Else
      cmblocation.List = ["Hospital", "Municipality", "Category", "District", "Province"]
    Endif
  Else
    Panel13.Visible = False
  Endif

  ''invoice
  cmbinvoice.List = ["Category", "Cashier", "Location", "Ledger A/C", "Status"]
  cmbinvoice.Text = "Category"
  cmbsource.List = ["Invoice", "Receipt"]
  cmbsource.Text = "Invoice"
  ''Register
  cmbregister.List = modNonMedical.FillDiscountCombo()
  cmbregister.Add("%")
  cmbregister.Text = "%"
  '' visit
  cmballmode.List = modNonMedical.FillCashModeCombo()
  cmballmode.Add("%")
  cmballmode.Text = "%"
  ''IP events
  ' cmbinpatstatus.List = ["Admissions", "Bed Occupancy", "Exits(All)", "Outcome"]
  cmbinpatstatus.List = ["Admissions", "Exits(All)", "Outcome"]
  cmbpackage.List = modNonMedical.FillDiscountCombo()
  cmbpackage.Add("%")
  cmbpackage.Text = "%"
  ''diagnostics
  cmbdiagnostic.List = ["Diagnostic Tests", "Radio Diagnostics"]
  ''dispensing
  cmbpharmacy.List = ["Medicines", "Surgicals", "Extra Items"]
  ''purchase
  cmbpurchase.List = ["Medicines", "Surgicals", "Extra Items"]
  ''general

  dtfir.Value = Now()
  dtlast.Value = Now()
  chkshowchart.Value = True

End

Public Sub WebForm_Open()

  modGeneralMain.RecordFormUse(Me)

End

Public Sub cmblocation_Click()

  cmbvalue.Clear()
  If cmblocation.Text Then
    cmbvalue.List = modDataRepo.GetRepoValueListType(cmblocation.Text)
  Endif

End

Private Sub ShowChartVisible()

  Dim xx As Boolean

  xx = chkshowchart.Value
  wbContinvoice.Visible = xx
  wbContregist.Visible = xx
  wbContallvisit.Visible = xx
  wbContipd.Visible = xx
  wbContdiagno.Visible = xx
  wbContobst.Visible = xx

End

Public Sub chkshowchart_Click()

  ShowChartVisible()

End

Public Sub dtnepfir_Click()

  Dim xx As String

  xx = BSDateFormat(("Enter BS Date in yyyy/mm/dd format"), ("Date Converter"), modDate.ConvertToLocaldate(dtfir.Value))
  If xx Then
    dtfir.Value = modDate.ConvertToEnglishdate(xx)
  Endif

End

Public Sub dtneplast_Click()

  Dim xx As String

  xx = BSDateFormat(("Enter BS Date in yyyy/mm/dd format"), ("Date Converter"), modDate.ConvertToLocaldate(dtlast.Value))
  If xx Then
    dtlast.Value = modDate.ConvertToEnglishdate(xx)
  Endif

End

Public Sub mnufiscal_Click()

  Dim res As Result
  Dim xyear As String

  GetTopNormalButtons()
  xyear = InputCombo("Select Fiscal Year Range", "Select Year", modBasic.$FiscalYearList, "", True)
  If xyear Then
    res = modDatabase.$myConn.Exec("select fldfrom,fldend from tblfiscalid where fldlabel=&1", xyear)
    If res.Available Then
      res.MoveFirst
      dtfir.Value = res["fldfrom"]
      dtlast.Value = res["fldend"]
    Endif
  Endif

End

Public Sub btntoday_Click()

  GetTopNormalButtons()
  dtfir.Value = Now()
  dtlast.Value = Now()
  btntoday.Background = Color.LightGray

End

Public Sub btnyesterday_Click()

  GetTopNormalButtons()
  dtfir.Value = DateAdd(Now(), gb.Day, -1)
  dtlast.Value = DateAdd(Now(), gb.Day, -1)
  btnyesterday.Background = Color.LightGray

End

Public Sub btnmonth_Click()

  GetTopNormalButtons()
  If modBasic.$DateFormat = "BS Date" Then
    dtfir.Value = modDate.StartSqlMonthBS(Now())
    dtlast.Value = modDate.EndSqlMonthBS(Now())
  Else
    dtfir.Value = modDate.StartSqlMonth(Now())
    dtlast.Value = modDate.EndSqlMonth(Now())
  Endif
  btnmonth.Background = Color.LightGray

End

Public Sub btnyear_Click()

  GetTopNormalButtons()
  If modBasic.$DateFormat = "BS Date" Then
    dtfir.Value = modDate.StartSqlYearBS(Now())
    dtlast.Value = modDate.EndSqlYearBS(Now())
  Else
    dtfir.Value = modDate.StartSqlYear(Now())
    dtlast.Value = modDate.EndSqlYear(Now())
  Endif
  btnyear.Background = Color.LightGray

End

Private Sub GetTopNormalButtons()

  btntoday.Background = Color.Default
  btnyesterday.Background = Color.Default
  btnmonth.Background = Color.Default
  btnyear.Background = Color.Default

End

Public Sub rfninvoice_Click()

  modCHTMLReport.ExportGridToHTML(GridView1, "Invoices" & ":" & cmbinvoice.Text, modReportVar.GetDateTimeReport(dtfir.Value, gb.MediumDate) & " To " & modReportVar.GetDateTimeReport(dtlast.Value, gb.MediumDate))

End

Public Sub rfnallvisit_Click()

  modCHTMLReport.ExportGridToHTML(GridView2, "Consultations", modReportVar.GetDateTimeReport(dtfir.Value, gb.MediumDate) & " To " & modReportVar.GetDateTimeReport(dtlast.Value, gb.MediumDate))

End

Public Sub rfninpat_Click()

  modCHTMLReport.ExportGridToHTML(GridView4, "InPatient Departments" & ":" & cmbinpatstatus.Text, modReportVar.GetDateTimeReport(dtfir.Value, gb.MediumDate) & " To " & modReportVar.GetDateTimeReport(dtlast.Value, gb.MediumDate))

End

Public Sub rfndiagno_Click()

  modCHTMLReport.ExportGridToHTML(GridView5, "Diagnostics" & ":" & cmbdiagnostic.Text, modReportVar.GetDateTimeReport(dtfir.Value, gb.MediumDate) & " To " & modReportVar.GetDateTimeReport(dtlast.Value, gb.MediumDate))

End

Public Sub rfnproced_Click()

  modCHTMLReport.ExportGridToHTML(GridView6, "Procedures", modReportVar.GetDateTimeReport(dtfir.Value, gb.MediumDate) & " To " & modReportVar.GetDateTimeReport(dtlast.Value, gb.MediumDate))

End

Public Sub rfndelivery_Click()

  modCHTMLReport.ExportGridToHTML(GridView8, "Delivery", modReportVar.GetDateTimeReport(dtfir.Value, gb.MediumDate) & " To " & modReportVar.GetDateTimeReport(dtlast.Value, gb.MediumDate))

End

Public Sub rfnpharmacy_Click()

  modCHTMLReport.ExportGridToHTML(GridView9, "Dispensing" & ":" & cmbpharmacy.Text, modReportVar.GetDateTimeReport(dtfir.Value, gb.MediumDate) & " To " & modReportVar.GetDateTimeReport(dtlast.Value, gb.MediumDate))

End

Public Sub rfnpurchase_Click()

  modCHTMLReport.ExportGridToHTML(GridView10, "Purchase" & ":" & cmbpurchase.Text, modReportVar.GetDateTimeReport(dtfir.Value, gb.MediumDate) & " To " & modReportVar.GetDateTimeReport(dtlast.Value, gb.MediumDate))

End

Public Sub WebButton1_Click()

  GetNormalButtons()
  TabPanel1.Index = 0
  WebButton1.Background = Color.LightGray

End

Public Sub WebButton2_Click()

  GetNormalButtons()
  TabPanel1.Index = 2
  WebButton2.Background = Color.LightGray

End

Public Sub WebButton3_Click()

  GetNormalButtons()
  TabPanel1.Index = 1
  WebButton3.Background = Color.LightGray

End

Public Sub WebButton4_Click()

  GetNormalButtons()
  TabPanel1.Index = 3
  WebButton4.Background = Color.LightGray

End

Public Sub WebButton5_Click()

  GetNormalButtons()
  TabPanel1.Index = 4
  WebButton5.Background = Color.LightGray

End

Public Sub WebButton6_Click()

  GetNormalButtons()
  TabPanel1.Index = 5
  WebButton6.Background = Color.LightGray

End

Public Sub WebButton7_Click()

  GetNormalButtons()
  TabPanel1.Index = 6
  WebButton7.Background = Color.LightGray

End

Public Sub WebButton8_Click()

  GetNormalButtons()
  TabPanel1.Index = 7
  WebButton8.Background = Color.LightGray

End

Public Sub WebButton9_Click()

  GetNormalButtons()
  TabPanel1.Index = 8
  WebButton9.Background = Color.LightGray

End

Private Sub GetNormalButtons()

  WebButton1.Background = Color.Default
  WebButton2.Background = Color.Default
  WebButton3.Background = Color.Default
  WebButton4.Background = Color.Default
  WebButton5.Background = Color.Default
  WebButton6.Background = Color.Default
  WebButton7.Background = Color.Default
  WebButton8.Background = Color.Default
  WebButton9.Background = Color.Default

End

Private Sub CreateChartImage(sType As String, sTitle As String, Column As Integer, xFinal As Variant[], xWebCanvas As WebCanvas)

  Dim xValues As Variant[]
  Dim yValues As Variant[]
  Dim sColl As Collection
  Dim xChart As Collection
  Dim sPath As String

  xValues = New Variant[]
  yValues = New Variant[]
  For Each sColl In xFinal
    If sColl["0"] = "Total" Then
    Else
      xValues.Add(sColl["0"])
      yValues.Add(CFloat(sColl[Column]))
    Endif
  Next
  xChart = modChartJS.GetHTMLChartScript(sType, sTitle, xValues, yValues)
  sPath = "new Chart(\"" & xWebCanvas.Name & "\", " & JSON.Encode(xChart) & ")"
  Me.Exec(sPath)

End

Private Sub CreateStackedBarImage(sTitle As String, xFinal As Variant[], xWebCanvas As WebCanvas)

  Dim xValues As Variant[]
  Dim yValues As Variant[]
  Dim zValues As Variant[]

  Dim aColl As Collection
  Dim xChart As Collection
  Dim sPath As String

  xValues = New Variant[]
  yValues = New Variant[]
  zValues = New Variant[]
  For Each aColl In xFinal
    xValues.Add(aColl["Category"])
    yValues.Add(aColl["Male"])
    zValues.Add(aColl["Female"])
  Next

  xChart = modChartJS.GetHTMLStackedScript("stacked", ["Male", "Female"], xValues, yValues, zValues)
  sPath = "new Chart(\"" & xWebCanvas.Name & "\", " & JSON.Encode(xChart) & ")"
  Me.Exec(sPath)

End

''--------------------------------------------- Confinement --------------------------------------------
Private Function GetDeliveryRecords(sType As String) As Result

  Dim xFldList As String[]
  Dim xhospfld As String
  Dim res As Result

  xhospfld = modDataRepo.HospitalField()
  xFldList = ["fldid", "fldencounterval", "fldencounterval", modDataRepo.SerialField(), "fldencounterval", "flddeltime", "flddeltype", "flddelresult", "flddelwt", "fldbabypatno", "fldbabypatno", "flddelphysician"]
  If xhospfld Then
    xFldList.Add(xhospfld)
  Endif
  res = modDatabase.$syConn.Exec("select " & xFldList.Join(",") & " from tblconfinement where flddeltime>=&1 and flddeltime<=&2 and flddelresult like &3" & modDataRepo.GetWhereStringRepo(cmblocation.Text, cmbvalue.Text), modDate.StartSqlDate(dtfir.value), modDate.EndSqlDate(dtlast.value), sType)

  Return res

End

Private Function GetGridViewValueDelivery(Column As Integer, xVariable As Variant) As Variant

  Dim xxx As Variant

  If Column = 2 Then
    xxx = modPatient.GetPatientNameByEnc(xVariable, modDatabase.$syConn)
  Else If Column = 3 Then
    xxx = modMedReports.GetPatientPastAgeString("tblconfinement", xVariable)
  Else If Column = 4 Then
    xxx = modPatient.GetPatientGuardianByEnc(xVariable)
  Else If Column = 5 Then
    xxx = modReportVar.GetDateTimeReport(xVariable, gb.GeneralDate)
  Else If Column = 10 Then
    xxx = modPatient.PatientGenderByPatNo(xVariable)
  Else If Column = 11 Then
    xxx = modGeneral.GetUserFullName(xVariable)
  Else If Column = 12 Then
    xxx = modDataRepo.GetHospitalTextLabel(xVariable)
  Else
    xxx = xVariable
  Endif
  Return xxx

End

Public Sub btndelivery_Click()

  Dim xFinal As Variant[]
  Dim delTyList As String[]
  Dim xWebCanv As WebCanvas

  delTyList = modControlSub.GetDirectFillresultNoNull(modDatabase.$syConn.Exec("select distinct(flddeltype) as col from tblconfinement where flddeltime>=&1 and flddeltime<=&2" & modDataRepo.GetWhereStringRepo(cmblocation.Text, cmbvalue.Text), modDate.StartSqlDate(dtfir.Value), modDate.EndSqlDate(dtlast.Value)))
  GridView8.Count = delTyList.Count
  GridView8.Columns.Count = 5

  xFinal = modDashBoard.GetConfinementReportDash(delTyList, dtfir.Value, dtlast.Value, cmblocation.Text, cmbvalue.Text)
  xGridData8 = xFinal

  With GridView8
    ' .Columns[0].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"
    .Columns[0].Expand = True
    .Columns[1].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
    .Columns[2].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
    .Columns[3].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
    .Columns[4].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"

    .Columns[0].Text = "Delivery Type"
    .Columns[1].Text = "Live Baby"
    .Columns[2].Text = "Fresh SB"
    .Columns[3].Text = "Macerated SB"
    .Columns[4].Text = "Total"
  End With

  If wbContobst.Children.Count Then
    wbContobst.DeleteChildren()
  Endif
  xWebCanv = New WebCanvas(wbContobst)
  xWebCanv.Expand = True
  CreateChartImage("bar", "Delivery Report", 4, xFinal, xWebCanv)

End

Public Sub GridView8_Data(Row As Integer, Column As Integer, Data As WebTableData)

  modGridView.GridViewDecoration(Data, Row)
  Data.Text = xGridData8[Row][CStr(Column)]

End

''---------------------------------------- op visit -------------------------------------------
Public Sub btnallvisit_Click()

  Dim grpList As String[]
  Dim frpList As String[]
  Dim xFinal As Variant[]
  Dim xWebCanv As WebCanvas

  Dim sVar As Variant[]
  Dim xColl As Collection
  Dim asx As Collection

  grpList = modControlSub.GetDirectFillresult(modDatabase.$syConn.Exec("select distinct(fldconsultname) as col from tblopvisit where fldconsulttime>=&1 and fldconsulttime<=&2 and fldconsultname like &3 and fldstatus<>&4" & modDataRepo.GetWhereStringRepo(cmblocation.Text, cmbvalue.Text), modDate.StartSqlDate(dtfir.Value), modDate.EndSqlDate(dtlast.Value), "%", "Cancelled"))
  frpList = modControlSub.GetDirectFillresult(modDatabase.$syConn.Exec("select distinct(fldconsultname) as col from tblconsult where fldconsulttime>=&1 and fldconsulttime<=&2 and fldconsultname like &3 and fldstatus<>&4" & modDataRepo.GetWhereStringRepo(cmblocation.Text, cmbvalue.Text), modDate.StartSqlDate(dtfir.Value), modDate.EndSqlDate(dtlast.Value), "%", "Cancelled"))
  GridView2.Count = frpList.Count + grpList.Count
  GridView2.Columns.Count = 5

  If grpList Then
    grpList.Sort()
  Endif
  xFinal = modDashBoard.GetAllVisitReportDash(frpList, grpList, dtfir.Value, dtlast.Value, cmblocation.Text, cmbvalue.Text, cmballmode.Text)
  xGridData2 = xFinal

  With GridView2
    ' .Columns[0].Width = CStr(300 * modBasic.$AppWidthRatio) & "px"
    .Columns[0].Expand = True
    .Columns[1].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
    .Columns[2].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
    .Columns[3].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
    .Columns[4].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"

    .Columns[0].Text = "Department"
    .Columns[1].Text = "Male"
    .Columns[2].Text = "Female"
    .Columns[3].Text = "Other"
    .Columns[4].Text = "Total"
  End With

  sVar = New Variant[]
  For Each asx In xFinal
    xColl = New Collection
    xColl.Add(asx[CStr(0)], "Category")
    xColl.Add(asx[CStr(1)], "Male")
    xColl.Add(asx[CStr(2)], "Female")
    xColl.Add(asx[CStr(3)], "Other")
    sVar.Add(xColl)
  Next

  If wbContallvisit.Children.Count Then
    wbContallvisit.DeleteChildren()
  Endif
  xWebCanv = New WebCanvas(wbContallvisit)
  xWebCanv.Expand = True
  ' CreateChartImage("bar", cmballmode.Text, 4, xFinal, xWebCanv)
  CreateStackedBarImage(cmballmode.Text, sVar, xWebCanv)

End

Public Sub GridView2_Data(Row As Integer, Column As Integer, Data As WebTableData)

  modGridView.GridViewDecoration(Data, Row)
  Data.Text = xGridData2[Row][CStr(Column)]

End

''--------------------------------- Procedures ----------------------------------------------
Private Function GetProcedureRecords() As Result

  Dim xFldList As String[]
  Dim xhospfld As String
  Dim res As Result

  xhospfld = modDataRepo.HospitalField()
  xFldList = ["fldid", "fldencounterval", "fldencounterval", modDataRepo.SerialField(), "fldencounterval", "fldtime", "flditem"]
  If xhospfld Then
    xFldList.Add(xhospfld)
  Endif
  res = modDatabase.$syConn.Exec("select " & xFldList.Join(",") & " from tblpatgeneral where fldtime>=&1 and fldtime<=&2 and fldinput=&3 and fldreportquali like &4" & modDataRepo.GetWhereStringRepo(cmblocation.Text, cmbvalue.Text), modDate.StartSqlDate(dtfir.value), modDate.EndSqlDate(dtlast.value), "Procedures", "Done")
  Return res

End

Private Function GetGridViewValueProcedure(Column As Integer, xVariable As Variant) As Variant

  Dim xxx As Variant

  If Column = 2 Then
    xxx = modPatient.GetPatientNameByEnc(xVariable, modDatabase.$syConn)
  Else If Column = 3 Then
    xxx = modMedReports.GetPatientPastAgeString("tblpatgeneral", xVariable)
  Else If Column = 4 Then
    xxx = modPatient.GetPatientSex(xVariable, modDatabase.$syConn)
  Else If Column = 5 Then
    xxx = modReportVar.GetDateTimeReport(xVariable, gb.GeneralDate)
  Else If Column = 7 Then
    xxx = modDataRepo.GetHospitalTextLabel(xVariable)
  Else
    xxx = xVariable
  Endif
  Return xxx

End

Public Sub btnproced_Click()

  $rData6 = GetProcedureRecords()
  $aMyFields6 = New String[]
  modGridView.ReadSmallData(GridView6, $rData6, $aMyFields6)
  With GridView6
    .Columns[0].Width = CStr(50) & "px"
    .Columns[1].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
    .Columns[2].Width = CStr(200 * modBasic.$AppWidthRatio) & "px"
    .Columns[3].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
    .Columns[4].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
    .Columns[5].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"
    .Columns[6].Width = CStr(400 * modBasic.$AppWidthRatio) & "px"

    .Columns[1].Text = "EncID"
    .Columns[2].Text = "Name"
    .Columns[3].Text = "Age"
    .Columns[4].Text = "Gender"
    .Columns[5].Text = "DateTime"
    .Columns[6].Text = "Procedure"
  End With

End

Public Sub GridView6_Data(Row As Integer, Column As Integer, Data As WebTableData)

  $rData6.MoveTo(Row)
  modGridView.GridViewDecoration(Data, Row)
  Data.Text = GetGridViewValueProcedure(Column, $rData6[$aMyFields6[Column]])

End

''-------------------- dispensing ---------------------
Private Function GetDispensingRecords(sType As String) As Result

  Dim res As Result

  res = modDatabase.$syConn.Exec("select fldroute,flditem,SUM(fldqtydisp-fldqtyret) as tot from tblpatdosing where fldsave_order=&1 and fldtime>=&2 and fldtime<=&3 and flditemtype=&4" & modDataRepo.GetWhereStringRepo(cmblocation.Text, cmbvalue.Text) & " GROUP BY flditem", True, modDate.StartSqlDate(dtfir.value), modDate.EndSqlDate(dtlast.value), sType)
  Return res

End

Private Function GetGridViewValueDispensing(Column As Integer, xVariable As Variant) As Variant

  Dim xxx As Variant

  If Column = 2 Then
    xxx = modReportVar.GetLocaleNumberFormat(xVariable, -2)
  Else
    xxx = xVariable
  Endif
  Return xxx

End

Public Sub btnpharmacy_Click()

  If cmbpharmacy.Text Then
    $rData9 = GetDispensingRecords(cmbpharmacy.Text)
    $aMyFields9 = New String[]
    modGridView.ReadSmallData(GridView9, $rData9, $aMyFields9)

    With GridView9
      .Columns[0].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[1].Expand = True
      ' .Columns[1].Width = CStr(450 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[0].Text = "Route"
      .Columns[1].Text = "Particulars"
      .Columns[2].Text = "Count"
    End With

  Endif

End

Public Sub GridView9_Data(Row As Integer, Column As Integer, Data As WebTableData)

  $rData9.MoveTo(Row)
  modGridView.GridViewDecoration(Data, Row)
  Data.Text = GetGridViewValueDispensing(Column, $rData9[$aMyFields9[Column]])

End

''-------------------------- Purchase --------------
Private Function GetPurchaserecords(sType As String) As Result

  Dim res As Result

  res = modDatabase.$syConn.Exec("select fldstockid,SUM(fldtotalqty-fldreturnqty) as totqty,AVG(fldnetcost) as netcost,SUM(fldnetcost*(fldtotalqty-fldreturnqty)) as totcost from tblpurchase where fldsav=&1 and fldtime>=&2 and fldtime<=&3 and fldcategory=&4" & modDataRepo.GetWhereStringRepo(cmblocation.Text, cmbvalue.Text) & " GROUP BY fldstockid", False, modDate.StartSqlDate(dtfir.value), modDate.EndSqlDate(dtlast.value), sType)                   ''
  Return res

End

Private Function GetGridViewValuePurchase(Column As Integer, xVariable As Variant) As Variant

  Dim xxx As Variant

  If Column = 1 Then
    xxx = modReportVar.GetLocaleNumberFormat(xVariable, -2)
  Else If Column = 2 Then
    xxx = modReportVar.GetLocaleNumberFormat(xVariable, gb.Currency)
  Else If Column = 3 Then
    xxx = modReportVar.GetLocaleNumberFormat(xVariable, gb.Currency)
  Else
    xxx = xVariable
  Endif
  Return xxx

End

Public Sub btnpurchase_Click()

  If cmbpharmacy.Text Then
    $rData10 = GetPurchaserecords(cmbpurchase.Text)
    $aMyFields10 = New String[]
    modGridView.ReadSmallData(GridView10, $rData10, $aMyFields10)

    With GridView10
      ' .Columns[0].Width = CStr(400 * modBasic.$AppWidthRatio) & "px"
      .Columns[0].Expand = True
      .Columns[1].Width = CStr(75 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[3].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[0].Text = "Particulars"
      .Columns[1].Text = "QTY"
      .Columns[2].Text = "Rate"
      .Columns[3].Text = "Total"
    End With

  Endif

End

Public Sub GridView10_Data(Row As Integer, Column As Integer, Data As WebTableData)

  $rData10.MoveTo(Row)
  modGridView.GridViewDecoration(Data, Row)
  Data.Text = GetGridViewValuePurchase(Column, $rData10[$aMyFields10[Column]])

End

''--------------------------------------- Invoice Report ----------------------------------------
Public Sub btninvoice_Click()

  Dim xFinal As Variant[]
  Dim grpList As String[]
  Dim xWebCanv As WebCanvas

  If cmbsource.Text Then
    If cmbinvoice.Text = "Cashier" Then
      grpList = modControlSub.GetDirectFillresult(modDatabase.$syConn.Exec("select distinct(flduserid) as col from tblpatbilldetail where fldtime>=&1 and fldtime<=&2" & modDataRepo.GetWhereStringRepo(cmblocation.Text, cmbvalue.Text), modDate.StartSqlDate(dtfir.value), modDate.EndSqlDate(dtlast.value)))
    Else If cmbinvoice.Text = "Location" Then
      grpList = modControlSub.GetDirectFillresult(modDatabase.$syConn.Exec("select distinct(fldcomp) as col from tblpatbilldetail where fldtime>=&1 and fldtime<=&2" & modDataRepo.GetWhereStringRepo(cmblocation.Text, cmbvalue.Text), modDate.StartSqlDate(dtfir.value), modDate.EndSqlDate(dtlast.value)))
    Else If cmbinvoice.Text = "Ledger A/C" Then
      grpList = modControlSub.GetDirectFillresult(modDatabase.$syConn.Exec("select distinct(fldbankname) as col from tblpatbilldetail where fldtime>=&1 and fldtime<=&2 and fldbankname like &3" & modDataRepo.GetWhereStringRepo(cmblocation.Text, cmbvalue.Text), modDate.StartSqlDate(dtfir.value), modDate.EndSqlDate(dtlast.value), "%"))
    Else If cmbinvoice.Text = "Status" Then
      grpList = ["OPD", "Admitted", "Discharged"]
    Else
      grpList = ["Counter Billing", "Pharmacy Billing", "Due Clearance"]
    Endif

    GridView1.Count = grpList.Count + 1
    GridView1.Columns.Count = 6

    xFinal = modDashBoard.GetInvoiceReportDash(cmbsource.Text, grpList, dtfir.Value, dtlast.Value, cmblocation.Text, cmbvalue.Text, cmbinvoice.Text)
    xGridData1 = xFinal

    With GridView1
      .Columns[0].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"
      .Columns[1].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[3].Width = CStr(120 * modBasic.$AppWidthRatio) & "px"
      .Columns[4].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"
      .Columns[5].Width = CStr(125 * modBasic.$AppWidthRatio) & "px"

      .Columns[0].Text = "Particulars"
      .Columns[1].Text = "SubTotal"
      .Columns[2].Text = "Disc"
      .Columns[3].Text = "Tax"
      .Columns[4].Text = "Credit"
      .Columns[5].Text = "Cash"
    End With

    If wbContinvoice.Children.Count Then
      wbContinvoice.DeleteChildren()
    Endif
    xWebCanv = New WebCanvas(wbContinvoice)
    xWebCanv.Expand = True
    CreateChartImage("bar", "Cash from " & cmbsource.Text, 5, xFinal.Copy(0, xFinal.Count - 1), xWebCanv)
  Endif

End

Public Sub GridView1_Data(Row As Integer, Column As Integer, Data As WebTableData)

  modGridView.GridViewDecoration(Data, Row)
  Data.Text = xGridData1[Row][CStr(Column)]

End

''---------------------------------- registration --------------------------------------
Public Sub btnregister_Click()

  Dim grpList As String[]
  Dim xFinal As Variant[]
  Dim xWebCanv As WebCanvas

  grpList = modControlSub.GetDirectFillresult(modDatabase.$syConn.Exec("select distinct(fldadmitlocat) as col from tblencounter where fldregdate>=&1 and fldregdate<=&2 and fldadmitlocat like &3" & modDataRepo.GetWhereStringRepo(cmblocation.Text, cmbvalue.Text), modDate.StartSqlDate(dtfir.Value), modDate.EndSqlDate(dtlast.Value), "%"))
  GridView3.Clear
  GridView3.Count = grpList.Count
  GridView3.Columns.Count = 4

  If grpList Then
    grpList.Sort()
  Endif
  xFinal = modDashBoard.GetRegisterReportDash(grpList, dtfir.Value, dtlast.Value, cmblocation.Text, cmbvalue.Text, cmbregister.Text)
  xGridData3 = xFinal

  With GridView3
    ' .Columns[0].Width = CStr(300 * modBasic.$AppWidthRatio) & "px"
    .Columns[0].Expand = True
    .Columns[1].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
    .Columns[2].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
    .Columns[3].Width = CStr(150 * modBasic.$AppWidthRatio) & "px"

    .Columns[0].Text = "Department"
    .Columns[1].Text = "New"
    .Columns[2].Text = "Follow Up"
    .Columns[3].Text = "Total"
  End With

  If wbContregist.Children.Count Then
    wbContregist.DeleteChildren()
  Endif
  xWebCanv = New WebCanvas(wbContregist)
  xWebCanv.Expand = True
  CreateChartImage("bar", cmbregister.Text, 3, xFinal, xWebCanv)

End

Public Sub GridView3_Data(Row As Integer, Column As Integer, Data As WebTableData)

  modGridView.GridViewDecoration(Data, Row)
  Data.Text = xGridData3[Row][CStr(Column)]

End

''---------------------------- In patients -------------------------------------
Public Sub btninpat_Click()

  Dim depList As String[]
  Dim xFinal As Variant[]
  Dim xWebCanv As WebCanvas

  Dim sVar As Variant[]
  Dim xColl As Collection
  Dim asx As Collection

  If cmbinpatstatus.Text Then
    If cmbinpatstatus.Text = "Admissions" Then
      depList = modControlSub.GetDirectFillresult(modDatabase.$syConn.Exec("select distinct(fldadmitward) as col from tblencounter where flddoa>=&1 and flddoa<=&2 and fldadmitlocat like &3" & modDataRepo.GetWhereStringRepo(cmblocation.Text, cmbvalue.Text), modDate.StartSqlDate(dtfir.Value), modDate.EndSqlDate(dtlast.Value), "%"))
    Else If cmbinpatstatus.Text = "Bed Occupancy" Then
      depList = modGeneral.GetDepartmentWithBedList()
    Else If cmbinpatstatus.Text = "Exits(All)" Then
      ' depList = modControlSub.GetDirectFillresult(modDatabase.$syConn.Exec("select distinct(flddept) as col from tbldepartmentbed where fldbed in(select fldcurrlocat from tblencounter where flddod>=&1 and flddod<=&2 and fldcurrlocat like &3)", modDate.StartSqlDate(dtfir.Value), modDate.EndSqlDate(dtlast.Value), "%"))
      depList = modGeneral.GetDepartmentWithBedList()
    Else If cmbinpatstatus.Text = "Outcome" Then
      depList = ["Discharged", "LAMA", "Refer", "Death", "Absconder"]
    Endif
    If depList Then
      depList.Sort()
    Endif

    GridView4.Count = depList.Count
    GridView4.Columns.Count = 5

    xFinal = modDashBoard.GetInPatientReportDash(depList, cmbpackage.Text, dtfir.Value, dtlast.Value, cmblocation.Text, cmbvalue.Text, cmbinpatstatus.Text)
    xGridData4 = xFinal

    With GridView4
      ' .Columns[0].Width = CStr(300 * modBasic.$AppWidthRatio) & "px"
      .Columns[0].Expand = True
      .Columns[1].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[3].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[4].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"

      If cmbinpatstatus.Text = "Admissions" Then
        .Columns[0].Text = "Registered"
      Else If cmbinpatstatus.Text = "Bed Occupancy" Then
        .Columns[0].Text = "Current"
      Else If cmbinpatstatus.Text = "Exits(All)" Then
        .Columns[0].Text = "Exit"
      Else If cmbinpatstatus.Text = "Outcome" Then
        .Columns[0].Text = "Outcome"
      Endif
      .Columns[1].Text = "Male"
      .Columns[2].Text = "Female"
      .Columns[3].Text = "Other"
      .Columns[4].Text = "Total"
    End With

    sVar = New Variant[]
    For Each asx In xFinal
      xColl = New Collection
      xColl.Add(asx[CStr(0)], "Category")
      xColl.Add(asx[CStr(1)], "Male")
      xColl.Add(asx[CStr(2)], "Female")
      sVar.Add(xColl)
    Next

    If wbContipd.Children.Count Then
      wbContipd.DeleteChildren()
    Endif
    xWebCanv = New WebCanvas(wbContipd)
    xWebCanv.Expand = True
    ' CreateChartImage("bar", cmbinpatstatus.Text, 3, xFinal, xWebCanv)
    CreateStackedBarImage(cmballmode.Text, sVar, xWebCanv)
  Endif

End

Public Sub GridView4_Data(Row As Integer, Column As Integer, Data As WebTableData)

  modGridView.GridViewDecoration(Data, Row)
  Data.Text = xGridData4[Row][CStr(Column)]

End

''-------------------------------- diagnostics -------------------
'NOTE:TWO CON
Public Sub btndiagno_Click()

  Dim depList As String[]
  Dim xFinal As Variant[]
  Dim xWebCanv As WebCanvas

  If cmbdiagnostic.Text Then
    If cmbdiagnostic.Text = "Diagnostic Tests" Then
      If MMain.$WebEntry = True Then
        depList = modMedicine.GetPathoCategoryList("Test")
      Else
        depList = modMedicine.GetPathoCategoryList("Test")
      Endif
    Else If cmbdiagnostic.Text = "Radio Diagnostics" Then
      If MMain.$WebEntry = True Then
        depList = modMedicine.GetPathoCategoryList("Radio")
      Else
        depList = modMedicine.GetPathoCategoryList("Radio")
      Endif
    Endif

    GridView5.Count = depList.Count
    GridView5.Columns.Count = 4

    xFinal = modDashBoard.GetDiagnosticReportDash(depList, dtfir.Value, dtlast.Value, cmblocation.Text, cmbvalue.Text, cmbdiagnostic.Text)
    xGridData5 = xFinal

    With GridView5
      ' .Columns[0].Width = CStr(300 * modBasic.$AppWidthRatio) & "px"
      .Columns[0].Expand = True
      .Columns[1].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[2].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"
      .Columns[3].Width = CStr(100 * modBasic.$AppWidthRatio) & "px"

      .Columns[0].Text = "Section"
      If cmbdiagnostic.Text = "Diagnostic Tests" Then
        .Columns[1].Text = "Sampled"
        .Columns[2].Text = "Reported"
        .Columns[3].Text = "Verified"
      Else If cmbdiagnostic.Text = "Radio Diagnostics" Then
        .Columns[1].Text = "Male"
        .Columns[2].Text = "Female"
        .Columns[3].Text = "Total"
      Endif
    End With

    If wbContdiagno.Children.Count Then
      wbContdiagno.DeleteChildren()
    Endif
    xWebCanv = New WebCanvas(wbContdiagno)
    xWebCanv.Expand = True
    If cmbdiagnostic.Text = "Diagnostic Tests" Then
      CreateChartImage("bar", cmbdiagnostic.Text, 1, xFinal, xWebCanv)
    Else If cmbdiagnostic.Text = "Radio Diagnostics" Then
      CreateChartImage("bar", cmbdiagnostic.Text, 3, xFinal, xWebCanv)
    Endif
  Endif

End

Public Sub GridView5_Data(Row As Integer, Column As Integer, Data As WebTableData)

  modGridView.GridViewDecoration(Data, Row)
  Data.Text = xGridData5[Row][CStr(Column)]

End

''======================= ALL REPORT ================================
Private Function GetRichTableStringFromResult(sType As String, sColmList As String[], res As Result) As String

  Dim xx As String
  Dim xhead As String
  Dim ref As ResultField
  Dim Column As Integer

  If res.Available Then
    xx = modRepoTemplete.HTMLTableSyntax()
    xx = xx & "<tr>" & gb.NewLine
    For Each xhead In sColmList
      xx = xx & "<td class='reportmid_table_h'>" & xhead & "</td>" & gb.NewLine
    Next
    xx = xx & "</tr>" & gb.NewLine

    For Each res
      xx = xx & "<tr>" & gb.NewLine
      Column = 0
      For Each ref In res.Fields
        If sType = "Procedures" Then
          xx = xx & "<td>" & GetGridViewValueProcedure(Column, res[ref.Name]) & "</td>" & gb.NewLine
        Else If sType = "Delivery" Then
          xx = xx & "<td>" & GetGridViewValueDelivery(Column, res[ref.Name]) & "</td>" & gb.NewLine
        Else If sType = "Dispensing" Then
          xx = xx & "<td>" & GetGridViewValueDispensing(Column, res[ref.Name]) & "</td>" & gb.NewLine
        Else If sType = "Purchase" Then
          xx = xx & "<td>" & GetGridViewValuePurchase(Column, res[ref.Name]) & "</td>" & gb.NewLine
        Else
          xx = xx & "<td>" & res[ref.Name] & "</td>" & gb.NewLine
        Endif
        Column = Column + 1
      Next
      xx = xx & "</tr>" & gb.NewLine
    Next
    xx = xx & "</table>"
  Else
    xx = ""
  Endif
  Return xx

End

Public Sub btnall_Click()

  Dim $BillingReport As CReportHTML
  Dim xPath As String
  Dim allList As String[] = ["Billing", "Registration", "Consultation", "Inpatient", "Diagnostics", "Procedures", "Delivery", "Dispensing", "Purchase"]
  Dim chapList As String[]

  chapList = SelectListView(("Select Components"), allList, False)
  If chapList And If chapList.Count Then
    $BillingReport = New CReportHTML(["Data"], "", "")
    $BillingReport.UserData.Add("SUMMARY REPORT", "PARAM1")
    $BillingReport.UserData.Add(modReportVar.GetDateTimeReport(dtfir.Value, gb.MediumDate) & " TO " & modReportVar.GetDateTimeReport(dtlast.Value, gb.MediumDate), "PARAM2")

    ''invoices
    If chapList.Exist("Billing") Then
      $BillingReport.AddSection("Invoices", True)
      AddInvoiceData($BillingReport)
      $BillingReport.AddSection("Receipts", True)
      AddReceiptData($BillingReport)
    Endif

    ''Register
    If chapList.Exist("Registration") Then
      $BillingReport.AddSection("Registration", True)
      AddRegistrationData($BillingReport)
    Endif

    ''consultation
    If chapList.Exist("Consultation") Then
      $BillingReport.AddSection("Consultations", True)
      AddConsultationData($BillingReport)
    Endif

    ''inpatient
    If chapList.Exist("Inpatient") Then
      $BillingReport.AddSection("InPatient Departments", True)
      AddInpatientsData($BillingReport)
    Endif

    ''diagnostics
    If chapList.Exist("Diagnostics") Then
      $BillingReport.AddSection("Diagnostics", True)
      AddDiagnosticData($BillingReport)
    Endif

    ''procedures
    If chapList.Exist("Procedures") Then
      $BillingReport.AddSection("Procedures", True)
      AddProcedureData($BillingReport)
    Endif

    ''delivery
    If chapList.Exist("Delivery") Then
      $BillingReport.AddSection("Delivery", True)
      AddDeliveryData($BillingReport)
    Endif

    ''dispensing
    If chapList.Exist("Dispensing") Then
      $BillingReport.AddSection("Dispensing", True)
      AddDispenseData($BillingReport)
    Endif

    ''purchase
    If chapList.Exist("Purchase") Then
      $BillingReport.AddSection("Purchase", True)
      AddPurchaseData($BillingReport)
    Endif

    xPath = $BillingReport.NewHTMLPath()
    modControlSub.DisplayReportExport(xPath)
  Endif

End

Private Sub AddInvoiceData($BillingReport As CReportHTML)

  Dim asx As New String[0]
  Dim invcolm As String[]
  Dim invrow As String[]
  Dim invstr As String

  invrow = ["Counter Billing", "Pharmacy Billing", "Due Clearance"]
  invcolm = ["Particulars", "SubTotal", "Disc", "Tax", "Credit", "Cash"]
  invstr = modString.GetRichTableStringFromVariant(invcolm, modDashBoard.GetInvoiceReportDash("Invoice", invrow, dtfir.Value, dtlast.Value, cmblocation.Text, cmbvalue.Text, "Category"))
  With asx
    .Add(invstr)
  End With
  $BillingReport.Add(asx)
  asx.Clear()
  With asx
    .Add("*****")
  End With
  $BillingReport.Add(asx)
  asx.Clear()

End

Private Sub AddReceiptData($BillingReport As CReportHTML)

  Dim asx As New String[0]
  Dim invcolm As String[]
  Dim invrow As String[]
  Dim invstr As String

  invrow = ["Counter Billing", "Pharmacy Billing", "Due Clearance"]
  invcolm = ["Particulars", "SubTotal", "Disc", "Tax", "Credit", "Cash"]
  invstr = modString.GetRichTableStringFromVariant(invcolm, modDashBoard.GetInvoiceReportDash("Receipt", invrow, dtfir.Value, dtlast.Value, cmblocation.Text, cmbvalue.Text, "Category"))
  With asx
    .Add(invstr)
  End With
  $BillingReport.Add(asx)
  asx.Clear()
  With asx
    .Add("*****")
  End With
  $BillingReport.Add(asx)
  asx.Clear()

End

Private Sub AddRegistrationData($BillingReport As CReportHTML)

  Dim asx As New String[0]
  Dim registList As String[]
  Dim xregist As String

  Dim registtcol As String[]
  Dim registrow As String[]
  Dim registstr As String

  registList = modNonMedical.FillDiscountCombo()
  registtcol = ["Department", "New", "Follow-up", "Total"]
  For Each xregist In registList
    registrow = New String[]
    registrow = modControlSub.GetDirectFillresult(modDatabase.$syConn.Exec("select distinct(fldadmitlocat) as col from tblencounter where fldregdate>=&1 and fldregdate<=&2 and fldadmitlocat like &3 and flddisctype=&4" & modDataRepo.GetWhereStringRepo(cmblocation.Text, cmbvalue.Text), modDate.StartSqlDate(dtfir.Value), modDate.EndSqlDate(dtlast.Value), "%", xregist))
    If registrow And If registrow.Count Then
      registrow.Sort()

      registstr = modString.GetRichTableStringFromVariant(registtcol, modDashBoard.GetRegisterReportDash(registrow, dtfir.Value, dtlast.Value, cmblocation.Text, cmbvalue.Text, xregist))
      $BillingReport.AddChapter(xregist)
      With asx
        .Add(registstr)
      End With
      $BillingReport.Add(asx)
      asx.Clear()
    Endif
  Next
  With asx
    .Add("*****")
  End With
  $BillingReport.Add(asx)
  asx.Clear()

End

Private Sub AddConsultationData($BillingReport As CReportHTML)

  Dim asx As New String[0]
  Dim consultList As String[]
  Dim xconsult As String

  Dim consultcol As String[]
  Dim consultrow As String[]
  Dim opvisitrow As String[]
  Dim consultstr As String

  consultList = modNonMedical.FillCashModeCombo()
  consultrow = modControlSub.GetDirectFillresult(modDatabase.$syConn.Exec("select distinct(fldconsultname) as col from tblconsult where fldconsulttime>=&1 and fldconsulttime<=&2 and fldconsultname like &3 and fldstatus<>&4" & modDataRepo.GetWhereStringRepo(cmblocation.Text, cmbvalue.Text), modDate.StartSqlDate(dtfir.Value), modDate.EndSqlDate(dtlast.Value), "%", "Cancelled"))
  opvisitrow = modControlSub.GetDirectFillresult(modDatabase.$syConn.Exec("select distinct(fldconsultname) as col from tblopvisit where fldconsulttime>=&1 and fldconsulttime<=&2 and fldconsultname like &3 and fldstatus<>&4" & modDataRepo.GetWhereStringRepo(cmblocation.Text, cmbvalue.Text), modDate.StartSqlDate(dtfir.Value), modDate.EndSqlDate(dtlast.Value), "%", "Cancelled"))
  If consultrow Then
    consultrow.Sort()
  Endif
  consultcol = ["Department", "Male", "Female", "Other", "Total"]
  For Each xconsult In consultList
    consultstr = modString.GetRichTableStringFromVariant(consultcol, modDashBoard.GetAllVisitReportDash(consultrow, opvisitrow, dtfir.Value, dtlast.Value, cmblocation.Text, cmbvalue.Text, xconsult))

    $BillingReport.AddChapter(xconsult)
    With asx
      .Add(consultstr)
    End With
    $BillingReport.Add(asx)
    asx.Clear()
  Next
  With asx
    .Add("*****")
  End With
  $BillingReport.Add(asx)
  asx.Clear()

End

Private Sub AddInpatientsData($BillingReport As CReportHTML)

  Dim asx As New String[0]
  Dim ipList As String[] = ["Admissions", "Exits(All)"]
  Dim xip As String

  Dim ipstatcol As String[]
  Dim ipstatrow As String[]
  Dim ipstatstr As String

  For Each xip In ipList
    If xip = "Admissions" Then
      ipstatrow = modControlSub.GetDirectFillresult(modDatabase.$syConn.Exec("select distinct(fldadmitlocat) as col from tblencounter where flddoa>=&1 and flddoa<=&2 and fldadmitlocat like &3", modDate.StartSqlDate(dtfir.Value), modDate.EndSqlDate(dtlast.Value), "%"))
      ipstatcol = ["RegistDepartment", "Male", "Female", "Total"]
    Else If xip = "Exits(All)" Then
      ipstatrow = modControlSub.GetDirectFillresult(modDatabase.$syConn.Exec("select distinct(flddept) as col from tbldepartmentbed where fldbed in(select fldcurrlocat from tblencounter where flddod>=&1 and flddod<=&2 and fldcurrlocat like &3)", modDate.StartSqlDate(dtfir.Value), modDate.EndSqlDate(dtlast.Value), "%"))
      ipstatcol = ["ExitDepartment", "Male", "Female", "Total"]
    Else If xip = "Outcome" Then
      ipstatrow = ["Discharged", "LAMA", "Refer", "Death", "Absconder"]
      ipstatcol = ["Outcome", "Male", "Female", "Total"]
    Endif
    If ipstatrow Then
      ipstatrow.Sort()
    Endif
    ipstatstr = modString.GetRichTableStringFromVariant(ipstatcol, modDashBoard.GetInPatientReportDash(ipstatrow, "%", dtfir.Value, dtlast.Value, cmblocation.Text, cmbvalue.Text, xip))

    $BillingReport.AddChapter(xip)
    With asx
      .Add(ipstatstr)
    End With
    $BillingReport.Add(asx)
    asx.Clear()
  Next
  With asx
    .Add("*****")
  End With
  $BillingReport.Add(asx)
  asx.Clear()

End

Private Sub AddDiagnosticData($BillingReport As CReportHTML)

  Dim asx As New String[0]
  Dim diagnoList As String[] = ["Diagnostic Tests", "Radio Diagnostics"]
  Dim xdiagno As String

  Dim diagnosol As String[]
  Dim diagnorow As String[]
  Dim diagnostr As String

  For Each xdiagno In diagnoList
    If xdiagno = "Diagnostic Tests" Then
      diagnorow = modMedicine.GetPathoCategoryList("Test")
      diagnosol = ["Section", "Sampled", "Reported", "Verified"]
    Else If xdiagno = "Radio Diagnostics" Then
      diagnorow = modMedicine.GetPathoCategoryList("Radio")
      diagnosol = ["Section", "Male", "Female", "Total"]
    Endif
    diagnostr = modString.GetRichTableStringFromVariant(diagnosol, modDashBoard.GetDiagnosticReportDash(diagnorow, dtfir.Value, dtlast.Value, cmblocation.Text, cmbvalue.Text, xdiagno))

    $BillingReport.AddChapter(xdiagno)
    With asx
      .Add(diagnostr)
    End With
    $BillingReport.Add(asx)
    asx.Clear()
  Next
  With asx
    .Add("*****")
  End With
  $BillingReport.Add(asx)
  asx.Clear()

End

Private Sub AddProcedureData($BillingReport As CReportHTML)

  Dim asx As New String[0]
  Dim procedcolm As String[]
  Dim procedstr As String

  procedcolm = ["SNo", "EncID", "Name", "Age", "Gender", "DateTime", "Procedure"]
  procedstr = GetRichTableStringFromResult("Procedures", procedcolm, GetProcedureRecords())

  With asx
    .Add(procedstr)
  End With
  $BillingReport.Add(asx)
  asx.Clear()
  With asx
    .Add("*****")
  End With
  $BillingReport.Add(asx)
  asx.Clear()

End

Private Sub AddDeliveryData($BillingReport As CReportHTML)

  Dim asx As New String[0]
  Dim delList As String[] = ["Live Baby", "Fresh Still Birth", "Macerated Still Birth"]
  Dim xdel As String

  Dim delivcolm As String[]
  Dim delivstr As String

  delivcolm = ["SNo", "EncID", "Mother", "Age", "Guardian", "DateTime", "DelMode", "Result", "Weight(g)", "BabyNo", "Baby Sex", "Consultant"]
  For Each xdel In delList
    $BillingReport.AddChapter(xdel)
    delivstr = GetRichTableStringFromResult("Delivery", delivcolm, GetDeliveryRecords(xdel))

    With asx
      .Add(delivstr)
    End With
    $BillingReport.Add(asx)
    asx.Clear()
  Next
  With asx
    .Add("*****")
  End With
  $BillingReport.Add(asx)
  asx.Clear()

End

Private Sub AddDispenseData($BillingReport As CReportHTML)

  Dim asx As New String[0]
  Dim medList As String[] = ["Medicines", "Surgicals", "Extra Items"]
  Dim xdisp As String
  Dim dispcolm As String[]
  Dim dispstr As String

  dispcolm = ["Route", "Particulars", "Count"]
  For Each xdisp In medList
    $BillingReport.AddChapter(xdisp)
    dispstr = GetRichTableStringFromResult("Dispensing", dispcolm, GetDispensingRecords(xdisp))

    With asx
      .Add(dispstr)
    End With
    $BillingReport.Add(asx)
    asx.Clear()
  Next
  With asx
    .Add("*****")
  End With
  $BillingReport.Add(asx)
  asx.Clear()

End

Private Sub AddPurchaseData($BillingReport As CReportHTML)

  Dim asx As New String[0]
  Dim medList As String[] = ["Medicines", "Surgicals", "Extra Items"]
  Dim xpurc As String

  Dim purchcolm As String[]
  Dim purchstr As String

  purchcolm = ["Particulars", "QTY", "Rate", "Total"]
  For Each xpurc In medList
    $BillingReport.AddChapter(xpurc)
    purchstr = GetRichTableStringFromResult("Purchase", purchcolm, GetPurchaserecords(xpurc))

    Wait
    With asx
      .Add(purchstr)
    End With
    $BillingReport.Add(asx)
    asx.Clear()
  Next
  With asx
    .Add("*****")
  End With
  $BillingReport.Add(asx)
  asx.Clear()

End
