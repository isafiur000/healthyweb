' Gambas module file

Public $SymptomMasterVar As Variant[]
Public $SymptomCompVar As Variant[]
Public $ExamMasterCompVar As Variant[]
Public $ExaminationCompVar As Variant[]

Public $MedicineDataVar As Collection
Public $ServiceDataVar As Collection
Public $StockDataVar As Collection

Public $UserProfileVar As Collection
Public $DepartmentVar As Collection
Public $DiscSchemeVar As Collection

Public $TestMastereData As Collection
Public $ExamMasterData As Collection
Public $RadioMasterData As Collection

Public Sub InitializeTableCache()

  $SymptomMasterVar = New Variant[]
  $SymptomCompVar = New Variant[]
  $ExamMasterCompVar = New Variant[]
  $ExaminationCompVar = New Variant[]

  $MedicineDataVar = New Collection
  $UserProfileVar = New Collection
  $ServiceDataVar = New Collection
  $StockDataVar = New Collection

  $DepartmentVar = New Collection
  $DiscSchemeVar = New Collection

  $TestMastereData = New Collection
  $ExamMasterData = New Collection
  $RadioMasterData = New Collection

End

''===================== OPTIONAL ========================================
''------------------- General ---------------------------
Public Sub LoadUserProfileData(sCon As Connection)

  Dim res As Result
  Dim sColl As Collection

  res = sCon.Exec("select flduserid,fldusername,fldusercode,fldcategory,fldcontact,fldemail,fldfaculty,fldpayable,fldreferral,fldopconsult,fldipconsult,fldonline,fldsigna,fldreport from tbluser where fldstatus=&1", "Active")            ''
  If res.Available Then
    For Each res
      sColl = New Collection
      sColl.Add(res["fldusername"], "fldusername")
      sColl.Add(res["fldusercode"], "fldusercode")
      sColl.Add(res["fldcategory"], "fldcategory")
      sColl.Add(res["fldcontact"], "fldcontact")
      sColl.Add(res["fldemail"], "fldemail")

      sColl.Add(res["fldfaculty"], "fldfaculty")
      sColl.Add(res["fldpayable"], "fldpayable")
      sColl.Add(res["fldreferral"], "fldreferral")
      sColl.Add(res["fldopconsult"], "fldopconsult")
      sColl.Add(res["fldipconsult"], "fldipconsult")
      sColl.Add(res["fldonline"], "fldonline")
      sColl.Add(res["fldsigna"], "fldsigna")
      sColl.Add(res["fldreport"], "fldreport")

      $UserProfileVar.Add(sColl, res["flduserid"])
    Next
  Endif

End

Public Sub LoadDepartmentMasterData(sCon As Connection)

  Dim res As Result
  Dim sColl As Collection

  res = sCon.Exec("select flddept,fldcateg,flddeptcode,fldactive,fldroom,fldhead,flddisctype,fldcomp,fldinterval,fldstart from tbldepartment")     ''
  If res.Available Then
    For Each res
      sColl = New Collection
      sColl.Add(res["fldcateg"], "fldcateg")
      sColl.Add(res["flddeptcode"], "flddeptcode")
      sColl.Add(res["fldactive"], "fldactive")
      sColl.Add(res["fldroom"], "fldroom")
      sColl.Add(res["fldhead"], "fldhead")
      sColl.Add(res["flddisctype"], "flddisctype")
      sColl.Add(res["fldcomp"], "fldcomp")
      sColl.Add(res["fldinterval"], "fldinterval")
      sColl.Add(res["fldstart"], "fldstart")

      $DepartmentVar.Add(sColl, res["flddept"])
    Next
  Endif

End

Public Sub LoadDiscountMasterData(sCon As Connection)

  Dim res As Result
  Dim sColl As Collection

  res = sCon.Exec("select fldtype,fldmode,fldpercent,fldamount,fldcredit,fldlimit,fldbillingmode,fldacledger,fldreference,fldbilltype,fldinvoice,fldreserved,fldcashincredit,fldyear,fldforce,fldqtylimit,fldfixdepart,fldlockstate,fldonline,fldoffspring,fldbankaccount from tbldiscount")     ''
  If res.Available Then
    For Each res
      sColl = New Collection
      sColl.Add(res["fldmode"], "fldmode")
      sColl.Add(res["fldpercent"], "fldpercent")
      sColl.Add(res["fldamount"], "fldamount")
      sColl.Add(res["fldcredit"], "fldcredit")
      sColl.Add(res["fldlimit"], "fldlimit")
      sColl.Add(res["fldbillingmode"], "fldbillingmode")
      sColl.Add(res["fldacledger"], "fldacledger")
      sColl.Add(res["fldreference"], "fldreference")
      sColl.Add(res["fldbilltype"], "fldbilltype")
      sColl.Add(res["fldinvoice"], "fldinvoice")
      sColl.Add(res["fldreserved"], "fldreserved")
      sColl.Add(res["fldcashincredit"], "fldcashincredit")
      sColl.Add(res["fldyear"], "fldyear")
      sColl.Add(res["fldforce"], "fldforce")
      sColl.Add(res["fldqtylimit"], "fldqtylimit")
      sColl.Add(res["fldfixdepart"], "fldfixdepart")
      sColl.Add(res["fldlockstate"], "fldlockstate")
      sColl.Add(res["fldonline"], "fldonline")
      sColl.Add(res["fldoffspring"], "fldoffspring")
      sColl.Add(res["fldbankaccount"], "fldbankaccount")

      $DiscSchemeVar.Add(sColl, res["fldtype"])
    Next
  Endif

End

''---------------- stock ---------------------
Public Sub LoadStockEntryData(sCon As Connection)

  Dim res As Result
  Dim sColl As Collection

  res = sCon.Exec("select fldstockno,fldstockid,fldcategory,fldbatch,fldexpiry,fldcost,fldmrp,fldcomp,fldcode,fldpast from tblentry where fldqty>&1", 0)
  If res.Available Then
    For Each res
      sColl = New Collection
      sColl.Add(res["fldstockid"], "fldstockid")
      sColl.Add(res["fldcategory"], "fldcategory")
      sColl.Add(res["fldbatch"], "fldbatch")
      sColl.Add(res["fldexpiry"], "fldexpiry")
      sColl.Add(res["fldcost"], "fldcost")
      sColl.Add(res["fldmrp"], "fldmrp")
      sColl.Add(res["fldcomp"], "fldcomp")
      sColl.Add(res["fldcode"], "fldcode")
      sColl.Add(res["fldpast"], "fldpast")

      $StockDataVar.Add(sColl, CStr(res["fldstockno"]))
    Next
  Endif

End

''----------------- Service -------------------
Public Sub LoadServiceCostData(sCon As Connection)

  Dim res As Result
  Dim sColl As Collection

  res = sCon.Exec("select flditemname,flditemcode,fldcode,fldid,fldbillitem,flditemtype,fldtarget,fldwaitday,fldgetcomment,fldgroup,fldreport,fldtaxcode,fldeditrate,fldeditdisc,fldpayable,fldpatentry,fldhospitalshare,fldinstrumshare,flddepartshare,fldanesthshare,fldothershare from tblservicecost where fldstatus=&1", "Active")            ''
  If res.Available Then
    For Each res
      sColl = New Collection
      sColl.Add(res["flditemcode"], "flditemcode")
      sColl.Add(res["fldcode"], "fldcode")
      sColl.Add(res["fldid"], "fldid")
      sColl.Add(res["fldbillitem"], "fldbillitem")
      sColl.Add(res["flditemtype"], "flditemtype")
      sColl.Add(res["fldtarget"], "fldtarget")
      sColl.Add(res["fldwaitday"], "fldwaitday")
      sColl.Add(res["fldgetcomment"], "fldgetcomment")

      sColl.Add(res["fldgroup"], "fldgroup")
      sColl.Add(res["fldreport"], "fldreport")
      sColl.Add(res["fldtaxcode"], "fldtaxcode")
      sColl.Add(res["fldeditrate"], "fldeditrate")
      sColl.Add(res["fldeditdisc"], "fldeditdisc")
      sColl.Add(res["fldpayable"], "fldpayable")
      sColl.Add(res["fldpatentry"], "fldpatentry")

      sColl.Add(res["fldhospitalshare"], "fldhospitalshare")
      sColl.Add(res["fldinstrumshare"], "fldinstrumshare")
      sColl.Add(res["flddepartshare"], "flddepartshare")
      sColl.Add(res["fldanesthshare"], "fldanesthshare")
      sColl.Add(res["fldothershare"], "fldothershare")

      $ServiceDataVar.Add(sColl, res["flditemname"])
    Next
  Endif

End

''----------------------- Medicine -------------------------------
Public Sub LoadMedicineMasterData(sCon As Connection)

  Dim res As Result
  Dim sColl As Collection

  res = sCon.Exec("select tblmedbrand.fldbrandid as fldbrandid,tblmedbrand.fldbrand as fldbrand,tbldrug.flddrug as flddrug,tblcode.fldcodename as fldcodename,tblmedbrand.flddosageform as flddosageform,tblmedbrand.fldmanufacturer as fldmanufacturer,tblmedbrand.flddetail as flddetail,tblmedbrand.fldstandard as fldstandard,tblmedbrand.fldpackvol as fldpackvol,tblmedbrand.fldvolunit as fldvolunit,tblmedbrand.fldpacksize as fldpacksize,tblmedbrand.fldmaxqty as fldmaxqty,tblmedbrand.fldminqty as fldminqty,tblmedbrand.fldleadtime as fldleadtime,tblmedbrand.fldpreservative as fldpreservative,tblmedbrand.fldnarcotic as fldnarcotic,tblmedbrand.fldtabbreak as fldtabbreak,tblmedbrand.flddeflabel as flddeflabel,tblmedbrand.fldtaxcode as fldtaxcode,tbldrug.fldstrength as fldstrength,tbldrug.fldstrunit as fldstrunit,tbldrug.fldroute as fldroute,tbldrug.flddoseunit as flddoseunit,tbldrug.fldhelppage as fldhelppage,tbldrug.fldciyear as fldciyear,tblcode.fldrecaddose as fldrecaddose,tblcode.fldrecaddoseunit as fldrecaddoseunit,tblcode.fldrecadfreq as fldrecadfreq,tblcode.fldrecpeddose as fldrecpeddose,tblcode.fldrecpeddoseunit as fldrecpeddoseunit,tblcode.fldrecpedfreq as fldrecpedfreq,tblcode.fldchemclass as fldchemclass,tblcode.fldcategory as fldcategory,tblcode.fldprn as fldprn,tblcode.flddrugdetail as flddrugdetail,tblcode.fldhelppage as fldhelppage,tblcode.fldreference as fldreference,tblcode.fldplasmaprotein as fldplasmaprotein,tblcode.fldeliminhalflife as fldeliminhalflife,tblcode.fldvoldistribution as fldvoldistribution,tblcode.fldeliminhepatic as fldeliminhepatic,tblcode.fldeliminrenal as fldeliminrenal,tblcode.fldmechaction as fldmechaction,tblcode.fldsensname as fldsensname,tblcode.fldrisklevel as fldrisklevel,tblcode.fldvaccine as fldvaccine from (tblmedbrand inner join tbldrug on tblmedbrand.flddrug=tbldrug.flddrug) inner join tblcode on tbldrug.fldcodename=tblcode.fldcodename where tblmedbrand.fldactive=&1", "Active")            ''
  If res.Available Then
    For Each res
      sColl = New Collection
      sColl.Add(res["flddrug"], "flddrug")
      sColl.Add(res["fldcodename"], "fldcodename")
      sColl.Add(res["fldbrand"], "fldbrand")
      sColl.Add(res["fldpackvol"], "fldpackvol")
      sColl.Add(res["fldvolunit"], "fldvolunit")
      sColl.Add(res["fldstrength"], "fldstrength")
      sColl.Add(res["fldstrunit"], "fldstrunit")
      sColl.Add(res["fldroute"], "fldroute")
      sColl.Add(res["fldcodename"], "fldcodename")

      sColl.Add(res["flddosageform"], "flddosageform")
      sColl.Add(res["fldmanufacturer"], "fldmanufacturer")
      sColl.Add(res["flddetail"], "flddetail")
      sColl.Add(res["fldstandard"], "fldstandard")
      sColl.Add(res["fldpacksize"], "fldpacksize")
      sColl.Add(res["fldmaxqty"], "fldmaxqty")
      sColl.Add(res["fldminqty"], "fldminqty")
      sColl.Add(res["fldleadtime"], "fldleadtime")
      sColl.Add(res["fldpreservative"], "fldpreservative")
      sColl.Add(res["fldnarcotic"], "fldnarcotic")
      sColl.Add(res["fldtabbreak"], "fldtabbreak")
      sColl.Add(res["flddeflabel"], "flddeflabel")
      sColl.Add(res["fldtaxcode"], "fldtaxcode")

      sColl.Add(res["flddoseunit"], "flddoseunit")
      sColl.Add(res["fldhelppage"], "fldhelppage")
      sColl.Add(res["fldciyear"], "fldciyear")

      sColl.Add(res["fldrecaddose"], "fldrecaddose")
      sColl.Add(res["fldrecaddoseunit"], "fldrecaddoseunit")
      sColl.Add(res["fldrecadfreq"], "fldrecadfreq")
      sColl.Add(res["fldrecpeddose"], "fldrecpeddose")
      sColl.Add(res["fldrecpeddoseunit"], "fldrecpeddoseunit")
      sColl.Add(res["fldrecpedfreq"], "fldrecpedfreq")
      sColl.Add(res["fldchemclass"], "fldchemclass")
      sColl.Add(res["fldcategory"], "fldcategory")
      sColl.Add(res["fldprn"], "fldprn")
      sColl.Add(res["flddrugdetail"], "flddrugdetail")
      sColl.Add(res["fldhelppage"], "fldhelppage")
      sColl.Add(res["fldreference"], "fldreference")
      sColl.Add(res["fldplasmaprotein"], "fldplasmaprotein")
      sColl.Add(res["fldeliminhalflife"], "fldeliminhalflife")
      sColl.Add(res["fldvoldistribution"], "fldvoldistribution")
      sColl.Add(res["fldeliminhepatic"], "fldeliminhepatic")
      sColl.Add(res["fldeliminrenal"], "fldeliminrenal")
      sColl.Add(res["fldmechaction"], "fldmechaction")
      sColl.Add(res["fldsensname"], "fldsensname")
      sColl.Add(res["fldrisklevel"], "fldrisklevel")
      sColl.Add(res["fldvaccine"], "fldvaccine")

      $MedicineDataVar.Add(sColl, res["fldbrandid"])
    Next
  Endif

End

Public Sub LoadTestMasterData(sCon As Connection)

  Dim res As Result
  Dim sColl As Collection

  res = sCon.Exec("SELECT fldtestid,fldcaption,fldcategory,fldsysconst,fldspecimen,fldspecmcode,fldcollection,flddetail,fldtype,fldsensitivity,fldspecificity,fldtestorder,fldcomment,fldoption,fldcritical FROM tbltest")     ''
  If res.Available Then
    For Each res
      sColl = New Collection
      sColl.Add(res["fldcaption"], "fldcaption")
      sColl.Add(res["fldcategory"], "fldcategory")
      sColl.Add(res["fldsysconst"], "fldsysconst")
      sColl.Add(res["fldspecimen"], "fldspecimen")
      sColl.Add(res["fldspecmcode"], "fldspecmcode")
      sColl.Add(res["fldcollection"], "fldcollection")
      sColl.Add(res["flddetail"], "flddetail")
      sColl.Add(res["fldtype"], "fldtype")
      sColl.Add(res["fldsensitivity"], "fldsensitivity")
      sColl.Add(res["fldspecificity"], "fldspecificity")
      sColl.Add(res["fldtestorder"], "fldtestorder")
      sColl.Add(res["fldcomment"], "fldcomment")
      sColl.Add(res["fldoption"], "fldoption")
      sColl.Add(res["fldcritical"], "fldcritical")

      $TestMastereData.Add(sColl, res["fldtestid"])
    Next
  Endif

End

Public Sub LoadExamMasterData(sCon As Connection)

  Dim res As Result
  Dim sColl As Collection

  res = sCon.Exec("SELECT fldexamid,fldcategory,fldsysconst,flddetail,fldtype,fldsensitivity,fldspecificity,fldcomment,fldoption,fldcritical,fldstatus FROM tblexam WHERE fldstatus=&1", "Active")     ''
  If res.Available Then
    For Each res
      sColl = New Collection
      sColl.Add(res["fldcategory"], "fldcategory")
      sColl.Add(res["fldsysconst"], "fldsysconst")
      sColl.Add(res["flddetail"], "flddetail")
      sColl.Add(res["fldtype"], "fldtype")
      sColl.Add(res["fldsensitivity"], "fldsensitivity")
      sColl.Add(res["fldspecificity"], "fldspecificity")
      sColl.Add(res["fldcomment"], "fldcomment")
      sColl.Add(res["fldoption"], "fldoption")
      sColl.Add(res["fldcritical"], "fldcritical")
      sColl.Add(res["fldstatus"], "fldstatus")

      $ExamMasterData.Add(sColl, res["fldexamid"])
    Next
  Endif

End

Public Sub LoadRadioMasterData(sCon As Connection)

  Dim res As Result
  Dim sColl As Collection

  res = sCon.Exec("SELECT fldexamid,fldcaption,fldcategory,fldsysconst,flddetail,fldtype,fldsensitivity,fldspecificity,fldcomment,fldoption,fldcritical from tblradio")     ''
  If res.Available Then
    For Each res
      sColl = New Collection
      sColl.Add(res["fldcaption"], "fldcaption")
      sColl.Add(res["fldcategory"], "fldcategory")
      sColl.Add(res["fldsysconst"], "fldsysconst")
      sColl.Add(res["flddetail"], "flddetail")
      sColl.Add(res["fldtype"], "fldtype")
      sColl.Add(res["fldsensitivity"], "fldsensitivity")
      sColl.Add(res["fldspecificity"], "fldspecificity")
      sColl.Add(res["fldcomment"], "fldcomment")
      sColl.Add(res["fldoption"], "fldoption")
      sColl.Add(res["fldcritical"], "fldcritical")

      $RadioMasterData.Add(sColl, res["fldexamid"])
    Next
  Endif

End

''====================== COMPULSORY ===================================
''----------------- Patho --------------------------------
Public Sub LoadSymptomsMasterData(sCon As Connection)

  Dim res As Result
  Dim sColl As Collection

  res = sCon.Exec("select fldsymptom,fldcategory,fldcode,fldsymdetail from tblsymptoms")     ''
  If res.Available Then
    For Each res
      sColl = New Collection
      sColl.Add(res["fldsymptom"], "fldsymptom")
      sColl.Add(res["fldcategory"], "fldcategory")
      sColl.Add(res["fldcode"], "fldcode")
      sColl.Add(res["fldsymdetail"], "fldsymdetail")
      $SymptomMasterVar.Add(sColl)
    Next
  Endif

End

Public Sub LoadSymptomsCompwiseData(sCon As Connection)

  Dim res As Result
  Dim sColl As Collection

  res = sCon.Exec("select fldsymptom,fldtype,fldflag from tblcomplaints where fldcomp=&1 or fldcomp=&2", modBasic.$compID, "%")     ''
  If res.Available Then
    For Each res
      sColl = New Collection
      sColl.Add(res["fldsymptom"], "fldsymptom")
      sColl.Add(res["fldtype"], "fldtype")
      sColl.Add(res["fldflag"], "fldflag")
      $SymptomCompVar.Add(sColl)
    Next
  Endif

End

Public Sub LoadExamCompMasterData(sCon As Connection)

  Dim res As Result
  Dim sColl As Collection

  res = sCon.Exec("select fldcategory,fldexamid,fldsysconst,fldtype,fldtanswertype,fldoptionlist,fldgroupname,fldexamorder,fldflag,fldcomp from tblcompexam ORDER BY fldexamorder")     ''
  If res.Available Then
    For Each res
      sColl = New Collection
      sColl.Add(res["fldcategory"], "fldcategory")
      sColl.Add(res["fldexamid"], "fldexamid")
      sColl.Add(res["fldsysconst"], "fldsysconst")
      sColl.Add(res["fldtype"], "fldtype")
      sColl.Add(res["fldtanswertype"], "fldtanswertype")
      sColl.Add(res["fldoptionlist"], "fldoptionlist")
      sColl.Add(res["fldgroupname"], "fldgroupname")
      sColl.Add(res["fldexamorder"], "fldexamorder")
      sColl.Add(res["fldflag"], "fldflag")
      sColl.Add(res["fldcomp"], "fldcomp")
      $ExamMasterCompVar.Add(sColl)
    Next
  Endif

  LoadExamsCompwiseData(sCon)

End

Public Sub LoadExamsCompwiseData(sCon As Connection)

  Dim sColl As Collection

  For Each sColl In $ExamMasterCompVar
    If sColl["fldcomp"] = modBasic.$compID Or If sColl["fldcomp"] = "%" Then
      $ExaminationCompVar.Add(sColl)
    Endif
  Next

End
