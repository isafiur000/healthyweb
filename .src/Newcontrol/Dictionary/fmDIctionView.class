' Gambas class file

Private $dictPath As String
Private $sCategory As String
Private $sValue As String

Public Sub Run(sCategory As String) As String

  $sCategory = sCategory

  Me.Title = $sCategory
  $dictPath = modBasic.$dictadvPath
  DisplayDictgrid()
  If modBasic.$TabletModeEnable = "Yes" Then
  Else
    txtselect.SetFocus
  Endif

  If Me.ShowModal() Then Return $sValue

End

Public Sub txtselect_Click()

  txtselect.Text = ""

End

Public Sub txtselect_Change()

  DisplayDictgrid()

End

Private Sub DisplayDictgrid()

  If Exist($dictPath) Then
    ListBox1.List = GetChapterList($dictPath, $sCategory)
  Endif

End

Private Sub GetChapterList(xdictPath As String, sCategory As String) As String[]

  Dim xxx As String[]
  Dim ConfFile As Settings
  Dim xtitle As String
  Dim xkey As String

  xxx = New String[]
  ConfFile = New Settings(xdictPath)
  For Each xtitle In ConfFile.Keys
    If xtitle = sCategory Then
      For Each xkey In ConfFile.Keys[xtitle]
        If LCase(xkey) Like LCase(txtselect.Text) & "*" Then
          xxx.Add(xkey)
        Endif
      Next
    Endif
  Next
  Return xxx

End

Public Sub txtselect_KeyPress()

  If Key.Code = "Down" Then
    If ListBox1.Count Then
      ListBox1.SetFocus
    Endif
  Endif

End

Public Sub btnok_Click()

  If ListBox1.Text Then
    $sValue = modControlSub.ShowSettingValue($dictPath, $sCategory & "/" & ListBox1.Text)
    Me.Close(True)
  Else
    Me.Close
  Endif

End

Public Sub btnclose_Click()

  Me.Close

End
