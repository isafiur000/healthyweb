' Gambas class file

Private $encid As String
Private $ItemList As String[]
Private $ItemListFlag As String[]
Private $sCategoryList As String[]
Private $sValueList As String[]

Private aWebPanel As New Object[100]
Private aMarkCheck As New Object[100]
Private aNameLabel As New Object[100]
Private aWebFrame As New Object[100]
Private aValueBox As New Object[100]
Private aComboBox As New Object[100]
Private aHourRadio As New Object[100]
Private aDayRadio As New Object[100]
Private aMonRadio As New Object[100]
Private aYearRadio As New Object[100]
Private bComboBox As New Object[100]
Private aWebLine As New Object[100]

Public Sub _new(encid As String)
  
  $encid = encid
  modGeneralMain.GetOpenModalForm(Me)
  
  $ItemList = modBasic.$ClinComplaintCompGrouped
  $ItemListFlag = modBasic.$ClinComplaintCompFlag
  GetItemListData()
  ListBox1.List = $sCategoryList
  
End

Private Sub LoadControls()
  
  Dim i As Integer
  
  For i = 0 To $sValueList.Count - 1
    If i < 99 Then
      aWebPanel[i] = New WebContainer(Frame1)
      aMarkCheck[i] = New WebCheckBox(aWebPanel[i]) As "IndexCheck"
      aNameLabel[i] = New WebHtml(aWebPanel[i])
      aWebFrame[i] = New WebContainer(Frame1)
      aValueBox[i] = New WebValueBox(aWebFrame[i])
      
      aComboBox[i] = New WebContainer(aWebFrame[i])
      aHourRadio[i] = New WebRadioButton(aComboBox[i])
      aDayRadio[i] = New WebRadioButton(aComboBox[i])
      aMonRadio[i] = New WebRadioButton(aComboBox[i])
      aYearRadio[i] = New WebRadioButton(aComboBox[i])
      
      bComboBox[i] = New WebComboBox(aWebFrame[i])
      aWebLine[i] = New WebContainer(Frame1)
    Endif
  Next
  
  For i = 0 To $sValueList.Count - 1
    If i < 99 Then
      
      With aWebPanel[i]
        .Class = "less-container-margin"
        .Arrangement = Arrange.Horizontal
      End With
      
      With aMarkCheck[i]
        .Width = "2em"
        .Height = "2em"
        .Tag = i
      End With
      With aNameLabel[i]
        .Font = "bold"
        .Text = "<p>" & $sValueList[i] & "</p>"
        ' .Height = "2em"
        .Tag = i
      End With
      
      With aWebFrame[i]
        .Class = "less-container-margin"
        .Arrangement = Arrange.Horizontal
        .Visible = False
      End With
      
      With aValueBox[i]
        .Width = "3em"
        .Height = "2em"
        .Tag = i
      End With
      
      With aComboBox[i]
        .Class = "less-container-margin"
        .Arrangement = Arrange.Horizontal
        .Spacing = True
      End With
      
      With aHourRadio[i]
        .Height = "2em"
        .Text = "Hour"
        .Tag = i
      End With
      With aDayRadio[i]
        .Height = "2em"
        .Text = "Day"
        .Tag = i
      End With
      With aMonRadio[i]
        .Height = "2em"
        .Text = "Month"
        .Tag = i
      End With
      With aYearRadio[i]
        .Height = "2em"
        .Text = "Year"
        .Tag = i
      End With
      
      With bComboBox[i]
        .Expand = True
        .Height = "2em"
        .ReadOnly = False
        .List = ["Episodes", "Both Side", "Left Side", "Right Side", "On/Off"]
        .Tag = i
      End With
      
      With aWebLine[i]
        .Height = "2em"
      End With
      
    Endif
  Next
  
End

Public Sub IndexCheck_Click()
  
  Dim i As Integer
  
  i = Last.Tag
  If aMarkCheck[i].Value = True Then
    aWebFrame[i].Visible = True
    If modBasic.$TabletModeEnable = "Yes" Then
    Else
      aValueBox[i].SetFocus
    Endif
  Else If aMarkCheck[i].Value = False Then
    aWebFrame[i].Visible = False
  Endif
  
End

Private Sub GetItemListData()
  
  Dim xx As String
  Dim asx As String[]
  Dim xval As String[]
  
  $sCategoryList = New String[]
  $sCategoryList.Add("Flagged")
  xval = New String[]
  For Each xx In $ItemList
    If xx Then
      asx = Split(xx, "@")
      
      If asx[0] Then
        If $sCategoryList.Count = 0 Then
          $sCategoryList.Add(asx[0])
        Else
          If $sCategoryList.Exist(asx[0]) = False Then
            $sCategoryList.Add(asx[0])
          Endif
        Endif
      Endif
      
    Endif
  Next
  ListBox1.List = $sCategoryList
  
End

Private Sub SHowComplaints()
  
  Dim xval As String[]
  Dim xx As String
  Dim asx As String[]
  
  Try $sValueList.Clear()
  Try Frame1.DeleteChildren()
  
  xval = New String[]
  If ListBox1.Text = "Flagged" Then
    For Each xx In $ItemListFlag
      If xx Then
        asx = Split(xx, "@")
        If xval.Count = 0 Then
          xval.Add(asx[1])
        Else
          If xval.Exist(asx[1]) = False Then
            xval.Add(asx[1])
          Endif
        Endif
      Endif
    Next
    
  Else
    For Each xx In $ItemList
      If xx Then
        asx = Split(xx, "@")
        If asx[0] = ListBox1.Text Then
          If xval.Count = 0 Then
            xval.Add(asx[1])
          Else
            If xval.Exist(asx[1]) = False Then
              xval.Add(asx[1])
            Endif
          Endif
        Endif
      Endif
    Next
    
  Endif
  
  $sValueList = xval
  LoadControls()
  
End

Public Sub btnshowall_Click()
  
  SHowComplaints()
  
End

Public Sub btnBrOK_Click()
  
  Dim i As Integer
  Dim xhour As Float
  Dim xdiff As String
  
  For i = 0 To $sValueList.Count - 1
    If i < 99 Then
      If aMarkCheck[i].Value = True Then
        xdiff = ""
        If aHourRadio[i].Value = True Then
          xdiff = "Hours"
        Else If aDayRadio[i].Value = True Then
          xdiff = "Days"
        Else If aMonRadio[i].Value = True Then
          xdiff = "Months"
        Else If aYearRadio[i].Value = True Then
          xdiff = "Years"
        Endif
        
        If xdiff Then
          xhour = aValueBox[i].Value * modDate.GetHoursValue(xdiff)
          modPatientGeneral.AddExamGeneralQualiQuantiData($encid, "Presenting Symptoms", $sValueList[i], bComboBox[i].Text, xhour, "")
        Else
          modPatientGeneral.AddExamGeneralQualiQuantiData($encid, "Presenting Symptoms", $sValueList[i], bComboBox[i].Text, 0, "")
        Endif
        
        'modPatientGeneral.AddExamGeneralQualiQuantiData($encid, "Presenting Symptoms", aNameLabel[i].Text, bComboBox[i].Text, xhour, "")
      Endif
    Endif
  Next
  Me.Exec("Toastify({text: 'Information saved', duration: 3000}).showToast()")
  ' Balloon.Delay = modBasic.$BalloonDelay
  
End

Public Sub btnBrChange_Click()
  
  Me.Close()
  
End

' Public Sub ListBox1_Render()
'   
'   modJavaScript.SetSelect2Combo(ListBox1)
'   
' End
